<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>××¢×¨×›×ª ×ª××—×•×¨ â€“ ×—×•×‘×•×ª ×”×œ×‘×‘×•×ª</title>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;600;700;800&display=swap" rel="stylesheet" />
  <style>
    body { font-family: 'Heebo', system-ui, sans-serif; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    const HVLPricingApp = () => {
      const defaultPricingData = {
        PRM: {
          name: 'PRM - ×¤×¨×™××™×•×', icon: 'âœ¨',
          ADT: { min: 15, max: 80, default: 15 },
          CHD: { min: 0, max: 20, default: 0 },
          FOD: '×›×œ×•×œ', KSH: ['×œ×', '×›×Ÿ'], WTR: 'calc', PRO: [0, 1, 2],
          CRK: ['×œ×', '×›×Ÿ'], CER: ['×œ×', '×›×Ÿ'], FLW: '×›×œ×•×œ', WIN: '×›×œ×•×œ',
          WINP: ['×œ×', '×›×Ÿ'], KIT: null,
          DSC: { min: 0, max: 15, default: 0 }, TIP: { min: 0, max: 15, default: 15 },
          IBASE: 9900, IMORE: 550, ICRK: 1000, IPRO: 75,
          OPRO1_15: 30, OPRO1_over: 15, OPRO2: 20,
          ICER: 350, OCER: 175, IWINP: 60, OWINP: 10,
          IKIT: null, OKIT: null,
          IFLW: '×›×œ×•×œ', OFLW: 800, IWIN: '×›×œ×•×œ', OWIN: 20,
          IKSH: 1500, OKSH: 1000,
          OCHEFB: 2100, OCHEF1: 40, OCHEF2: null,
          OFOD: 70, OCLEAN: 500, OEVM: 700, OWTR: 400, OOVH: 750
        },
        OFS: {
          name: 'OFS - ××•×¤×¡×™×™×˜', icon: 'ğŸ•ï¸',
          ADT: { min: 10, max: 70, default: 10 }, CHD: null,
          FOD: ['×œ×', '×›×Ÿ'], KSH: ['×œ×', '×›×Ÿ'], WTR: [0, 1, 2], PRO: [0, 1, 2],
          CRK: ['×œ×', '×›×Ÿ'], CER: ['×œ×', '×›×Ÿ'], FLW: ['×œ×', '×›×Ÿ'], WIN: ['×œ×', '×›×Ÿ'],
          WINP: null, KIT: ['×œ×', '×›×Ÿ'],
          DSC: { min: 0, max: 15, default: 0 }, TIP: { min: 0, max: 15, default: 15 },
          IBASE: 5500, IMORE: 500, ICRK: 1000, IPRO: 75,
          OPRO1_15: 30, OPRO1_over: 15, OPRO2: 20,
          ICER: 350, OCER: 175, IWINP: null, OWINP: null,
          IKIT: 150, OKIT: 0,
          IFLW: 1200, OFLW: 800, IWIN: 70, OWIN: 20,
          IKSH: 1500, OKSH: 1000,
          OCHEFB: 1200, OCHEF1: null, OCHEF2: 30,
          OFOD: 70, OCLEAN: 500, OEVM: 700, OWTR: 400, OOVH: 750
        },
        CKT: {
          name: 'CKT - ×§×•×§×˜×œ×™×', icon: 'ğŸ¸',
          ADT: { min: 15, max: 80, default: 15 },
          CHD: { min: 0, max: 20, default: 0 },
          FOD: '×›×œ×•×œ', KSH: ['×œ×', '×›×Ÿ'], WTR: 'calc', PRO: [0, 1, 2],
          CRK: ['×œ×', '×›×Ÿ'], CER: ['×œ×', '×›×Ÿ'], FLW: '×›×œ×•×œ', WIN: '×›×œ×•×œ',
          WINP: ['×œ×', '×›×Ÿ'], KIT: null,
          DSC: { min: 0, max: 15, default: 0 }, TIP: { min: 0, max: 15, default: 15 },
          IBASE: 7050, IMORE: 470, ICRK: 1000, IPRO: 75,
          OPRO1_15: 30, OPRO1_over: 15, OPRO2: 20,
          ICER: 350, OCER: 175, IWINP: 60, OWINP: 10,
          IKIT: null, OKIT: null,
          IFLW: '×›×œ×•×œ', OFLW: 800, IWIN: '×›×œ×•×œ', OWIN: 20,
          IKSH: 1500, OKSH: 1000,
          OCHEFB: 1400, OCHEF1: 40, OCHEF2: null,
          OFOD: 55, OCLEAN: 500, OEVM: 700, OWTR: 400, OOVH: 750
        },
        BRC: {
          name: "BRC - ×‘×¨×× ×¥'", icon: 'ğŸ¥',
          ADT: { min: 15, max: 80, default: 15 },
          CHD: { min: 0, max: 20, default: 0 },
          FOD: '×›×œ×•×œ', KSH: ['×œ×', '×›×Ÿ'], WTR: 'calc', PRO: [0, 1, 2],
          CRK: ['×œ×', '×›×Ÿ'], CER: ['×œ×', '×›×Ÿ'], FLW: '×›×œ×•×œ', WIN: '×›×œ×•×œ',
          WINP: ['×œ×', '×›×Ÿ'], KIT: null,
          DSC: { min: 0, max: 15, default: 0 }, TIP: { min: 0, max: 15, default: 15 },
          IBASE: 8250, IMORE: 500, ICRK: 1000, IPRO: 75,
          OPRO1_15: 30, OPRO1_over: 15, OPRO2: 20,
          ICER: 350, OCER: 175, IWINP: 60, OWINP: 10,
          IKIT: null, OKIT: null,
          IFLW: 1200, OFLW: 800, IWIN: '×›×œ×•×œ', OWIN: 20,
          IKSH: 1500, OKSH: 1000,
          OCHEFB: 1400, OCHEF1: 40, OCHEF2: null,
          OFOD: 70, OCLEAN: 500, OEVM: 700, OWTR: 400, OOVH: 750
        },
        RNT: {
          name: 'RNT - ×”×©×›×¨×ª ×—×œ×œ', icon: 'ğŸ›ï¸',
          ADT: { min: 15, max: 80, default: 15 },
          CHD: { min: 0, max: 20, default: 0 },
          FOD: null, KSH: null, WTR: [0, 1, 2], PRO: [0, 1, 2],
          CRK: null, CER: null, FLW: ['×œ×', '×›×Ÿ'], WIN: ['×œ×', '×›×Ÿ'],
          WINP: null, KIT: ['×œ×', '×›×Ÿ'],
          DSC: { min: 0, max: 15, default: 0 }, TIP: { min: 0, max: 15, default: 15 },
          IBASE: 5500, IMORE_per10: 1000,
          ICRK: null, IPRO: 75,
          OPRO1_15: 30, OPRO1_over: 15, OPRO2: 20,
          ICER: null, OCER: null, IWINP: null, OWINP: null,
          IKIT: 1000, OKIT: 0,
          IFLW: 1200, OFLW: 800, IWIN: 70, OWIN: 20,
          IKSH: null, OKSH: null,
          OCHEFB: null, OCHEF1: null, OCHEF2: null,
          OFOD: null, OCLEAN: 500, OEVM: 700, OWTR: 400, OOVH: null
        }
      };

      const [pricingData] = useState(defaultPricingData);
      const [eventType, setEventType] = useState('PRM');
      const [params, setParams] = useState({});

      const urlParams = new URLSearchParams(window.location.search);
      const mondayItemId = urlParams.get('itemId');

      const [copied, setCopied] = useState(false);
      const [showPreview, setShowPreview] = useState(false);
      const [pdfLoading, setPdfLoading] = useState(false);
      const [mondayStatus, setMondayStatus] = useState('');
      const [saved, setSaved] = useState(false);

      useEffect(() => {
        const config = pricingData[eventType];
        setParams({
          ADT: config.ADT ? config.ADT.default : 0,
          CHD: config.CHD ? config.CHD.default : 0,
          FOD: config.FOD === '×›×œ×•×œ' ? '×›×Ÿ' : (Array.isArray(config.FOD) ? config.FOD[0] : null),
          KSH: Array.isArray(config.KSH) ? config.KSH[0] : null,
          WTR: 0,
          PRO: Array.isArray(config.PRO) ? config.PRO[0] : 0,
          CRK: Array.isArray(config.CRK) ? config.CRK[0] : null,
          CER: Array.isArray(config.CER) ? config.CER[0] : null,
          FLW: config.FLW === '×›×œ×•×œ' ? '×›×Ÿ' : (Array.isArray(config.FLW) ? config.FLW[0] : null),
          WIN: config.WIN === '×›×œ×•×œ' ? '×›×Ÿ' : (Array.isArray(config.WIN) ? config.WIN[0] : null),
          WINP: Array.isArray(config.WINP) ? config.WINP[0] : null,
          KIT: Array.isArray(config.KIT) ? config.KIT[0] : null,
          DSC: config.DSC ? config.DSC.default : 0,
          TIP: config.TIP ? config.TIP.default : 15
        });
      }, [eventType]);

      const calculateWaiters = () => {
        const config = pricingData[eventType];
        const totalGuests = (params.ADT || 0) + (params.CHD || 0);
        if (config.WTR === 'calc') return Math.ceil(totalGuests / 20);
        if (Array.isArray(config.WTR)) return params.WTR || 0;
        return 0;
      };

      const calculatePricing = () => {
        const config = pricingData[eventType];
        const totalGuests = (params.ADT || 0) + (params.CHD || 0);
        const adults = params.ADT || 0;
        const children = params.CHD || 0;
        let income = [], outcome = [];

        income.push({ label: '×—×‘×™×œ×ª ×‘×¡×™×¡ (×¢×“ 15 ×× ×©×™×)', amount: config.IBASE });

        if (eventType === 'RNT' && config.IMORE_per10) {
          const extra = Math.max(0, totalGuests - 15);
          const groups = Math.ceil(extra / 10);
          if (groups > 0) income.push({ label: `×ª×•×¡×¤×ª ××•×¨×—×™× (${groups * 10} ×× ×©×™×)`, amount: groups * config.IMORE_per10 });
        } else if (config.IMORE && totalGuests > 15) {
          const extra = totalGuests - 15;
          income.push({ label: `×ª×•×¡×¤×ª ××•×¨×—×™× (${extra} Ã— ${config.IMORE} ×©"×—)`, amount: extra * config.IMORE });
        }

        if (params.CRK === '×›×Ÿ' && config.ICRK) income.push({ label: '×“××™ ×—×œ×™×¦×”', amount: config.ICRK });

        if (eventType === 'OFS' && params.FOD === '×›×Ÿ') {
          income.push({ label: `××•×›×œ (${totalGuests} Ã— 500 ×©"×—)`, amount: totalGuests * 500 });
        }

        if (params.PRO > 0 && config.IPRO) {
          income.push({ label: `×ª×•×¡×¤×ª ${params.PRO} ×× ×•×ª ×—×œ×‘×•×Ÿ (${totalGuests} Ã— ${params.PRO} Ã— ${config.IPRO} ×©"×—)`, amount: params.PRO * totalGuests * config.IPRO });
          const first15 = Math.min(totalGuests, 15), over15 = Math.max(0, totalGuests - 15);
          outcome.push({ label: `×¢×œ×•×ª ×—×œ×‘×•×Ÿ - ×—×•××¨ ×’×œ×`, amount: -(params.PRO * ((first15 * config.OPRO1_15) + (over15 * config.OPRO1_over))) });
          outcome.push({ label: `×¢×œ×•×ª ×—×œ×‘×•×Ÿ - ××•×¢×‘×¨ ×œ×©×£`, amount: -(params.PRO * totalGuests * config.OPRO2) });
        }

        if (params.CER === '×›×Ÿ' && config.ICER) {
          income.push({ label: `×¡×“× ×ª ×§×¨××™×§×” (${totalGuests} Ã— ${config.ICER} ×©"×—)`, amount: totalGuests * config.ICER });
          outcome.push({ label: `×¢×œ×•×ª ×¡×“× ×ª ×§×¨××™×§×”`, amount: -totalGuests * config.OCER });
        }

        if (params.WINP === '×›×Ÿ' && config.IWINP) {
          income.push({ label: `×ª×•×¡×¤×ª ×™×™×Ÿ ×¤×¨×™××™×•× (${adults} Ã— ${config.IWINP} ×©"×—)`, amount: adults * config.IWINP });
          outcome.push({ label: `×¢×œ×•×ª ×™×™×Ÿ ×¤×¨×™××™×•×`, amount: -adults * config.OWINP });
        }

        if (params.KIT === '×›×Ÿ' && config.IKIT) income.push({ label: '×©×™××•×© ×‘××˜×‘×—', amount: config.IKIT });

        if (config.IFLW !== '×›×œ×•×œ' && params.FLW === '×›×Ÿ' && config.IFLW) income.push({ label: '×¤×¨×—×™×', amount: config.IFLW });
        if (params.FLW === '×›×Ÿ' || config.FLW === '×›×œ×•×œ') outcome.push({ label: '×¢×œ×•×ª ×¤×¨×—×™×', amount: -config.OFLW });

        if (config.WIN !== '×›×œ×•×œ' && config.IWIN !== '×›×œ×•×œ' && params.WIN === '×›×Ÿ' && config.IWIN) income.push({ label: `×™×™×Ÿ (${adults} Ã— ${config.IWIN} ×©"×—)`, amount: adults * config.IWIN });
        if (params.WIN === '×›×Ÿ' || config.WIN === '×›×œ×•×œ') outcome.push({ label: `×¢×œ×•×ª ×™×™×Ÿ`, amount: -adults * config.OWIN });

        if (params.KSH === '×›×Ÿ' && config.IKSH) {
          income.push({ label: '×”×›×©×¨×ª ×¨×‘', amount: config.IKSH });
          outcome.push({ label: '×¢×œ×•×ª ×”×›×©×¨×ª ×¨×‘', amount: -config.OKSH });
        }

        if (config.OCHEFB) {
          outcome.push({ label: '×©×£ ×‘×¡×™×¡', amount: -config.OCHEFB });
          if (config.OCHEF1 && totalGuests > 35) outcome.push({ label: `×©×£ ×ª×•×¡×¤×ª`, amount: -(totalGuests - 35) * config.OCHEF1 });
          if (config.OCHEF2 && totalGuests > 10) outcome.push({ label: `×©×£ ×ª×•×¡×¤×ª`, amount: -(totalGuests - 10) * config.OCHEF2 });
        }

        const cookDiv = eventType === 'PRM' ? 20 : 28;
        const cooks = Math.floor(totalGuests / cookDiv);
        if (cooks > 0 && config.OFOD !== null) outcome.push({ label: `×˜×‘×— × ×•×¡×£ (${cooks})`, amount: -cooks * 500 });

        if (config.OFOD && (params.FOD === '×›×Ÿ' || config.FOD === '×›×œ×•×œ')) outcome.push({ label: `×¢×œ×•×ª ××•×›×œ`, amount: -totalGuests * config.OFOD });

        if (config.OCLEAN) outcome.push({ label: '× ×§×™×•×Ÿ', amount: -config.OCLEAN });
        if (config.OEVM) outcome.push({ label: '×× ×”×œ ××™×¨×•×¢', amount: -config.OEVM });

        const waiters = calculateWaiters();
        if (waiters > 0 && config.OWTR) outcome.push({ label: `××œ×¦×¨×™× (${waiters})`, amount: -waiters * config.OWTR });
        if (config.OOVH) outcome.push({ label: '×ª×§×•×¨×” ×§×‘×•×¢×”', amount: -config.OOVH });

        const totalIncome = income.reduce((s, i) => s + i.amount, 0);
        let childrenDiscount = children > 0 ? -children * 100 : 0;
        let percentageDiscount = params.DSC > 0 ? -(totalIncome * params.DSC / 100) : 0;
        const REV = totalIncome + childrenDiscount + percentageDiscount;
        const salesBonus = -REV * 0.03;
        outcome.push({ label: '×‘×•× ×•×¡ ×× ×”×œ ××›×™×¨×•×ª (3%)', amount: salesBonus });
        const totalOutcome = outcome.reduce((s, i) => s + i.amount, 0);
        const COG = totalOutcome;
        const GDP = REV + COG;
        const vat = REV * 0.18;
        const tip = (REV + vat) * (params.TIP / 100);
        const finalTotal = REV + vat + tip;

        return { income, outcome, childrenDiscount, percentageDiscount, REV, COG, GDP, vat, tip, finalTotal };
      };

      const fmt = (num) => Math.round(num).toLocaleString('he-IL');
      const R = '\u200F';
      const fmtR = (num) => `${R}${Math.round(num).toLocaleString('he-IL')}`;
      const boldHebrew = (text) => `*${text}*`;

      const generateWhatsAppMessage = () => {
        const calc = calculatePricing();
        const config = pricingData[eventType];
        const totalGuests = (params.ADT || 0) + (params.CHD || 0);
        const adults = params.ADT || 0;
        const children = params.CHD || 0;
        const eventNames = { PRM: '×¤×¨×™××™×•×', OFS: '××•×¤×¡×™×™×˜', CKT: '×§×•×§×˜×œ×™×', BRC: "×‘×¨×× ×¥'", RNT: '×”×©×›×¨×ª ×—×œ×œ' };

        const now = new Date();
        const dd = String(now.getDate()).padStart(2, '0');
        const mm = String(now.getMonth() + 1).padStart(2, '0');
        const yy = String(now.getFullYear()).slice(-2);
        const hh = String(now.getHours()).padStart(2, '0');
        const min = String(now.getMinutes()).padStart(2, '0');
        const quoteNum = `${dd}${mm}${yy}-${hh}${min}`;

        let m = '';
        m += `${R}${boldHebrew('×”×¦×¢×ª ××—×™×¨ ×—×•×‘×•×ª ×”×œ×‘×‘×•×ª')} ğŸŒ¿\n`;
        m += `${R}×”×¦×¢×” ××¡×¤×¨: ${R}${quoteNum}\n`;
        m += `â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n\n`;
        m += `${R}${boldHebrew('×¤×¨×˜×™ ×”××™×¨×•×¢')} ğŸ“‹\n`;
        m += `${R}×¡×•×’: ${eventNames[eventType]}\n`;
        m += `${R}××‘×•×’×¨×™×: ${R}${adults}`;
        if (children > 0) m += ` | ×™×œ×“×™×: ${R}${children}`;
        m += `\n${R}×¡×”"×› ××©×ª×ª×¤×™×: ${R}${totalGuests}\n`;

        const included = [];
        if (config.FOD === '×›×œ×•×œ') included.push('××•×›×œ ğŸ½ï¸');
        if (config.FLW === '×›×œ×•×œ') included.push('×¤×¨×—×™× ğŸ’');
        if (config.WIN === '×›×œ×•×œ') included.push('×™×™×Ÿ ğŸ·');
        if (included.length > 0) m += `\n${R}${boldHebrew('×›×œ×•×œ ×‘×—×‘×™×œ×”:')} ${included.join(', ')}\n`;

        const extras = [];
        if (params.KSH === '×›×Ÿ') extras.push('×›×©×¨×•×ª ×¨×‘');
        if (params.CRK === '×›×Ÿ') extras.push('×“××™ ×—×œ×™×¦×”');
        if (params.CER === '×›×Ÿ') extras.push('×¡×“× ×ª ×§×¨××™×§×” ğŸ¨');
        if (config.FLW !== '×›×œ×•×œ' && params.FLW === '×›×Ÿ') extras.push('×¤×¨×—×™× ğŸ’');
        if (config.WIN !== '×›×œ×•×œ' && params.WIN === '×›×Ÿ') extras.push('×™×™×Ÿ ğŸ·');
        if (params.WINP === '×›×Ÿ') extras.push('×™×™×Ÿ ×¤×¨×™××™×•× ğŸ¥‚');
        if (params.KIT === '×›×Ÿ') extras.push('×©×™××•×© ×‘××˜×‘×—');
        if (config.FOD !== '×›×œ×•×œ' && params.FOD === '×›×Ÿ') extras.push('××•×›×œ ğŸ½ï¸');
        if ((params.PRO || 0) > 0) extras.push(`${R}${params.PRO} ×× ×•×ª ×—×œ×‘×•×Ÿ ×œ××“× ğŸ¥©`);
        if (extras.length > 0) {
          m += `\n${R}${boldHebrew('×ª×•×¡×¤×•×ª:')} âœ…\n`;
          extras.forEach(e => { m += `${R}â€¢ ${e}\n`; });
        }

        m += `\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n`;
        m += `${R}${boldHebrew('×¤×™×¨×•×˜ ×¢×œ×•×™×•×ª')} ğŸ’°\n\n`;
        calc.income.forEach(item => { m += `${R}${item.label}: ${fmtR(item.amount)} ×©"×—\n`; });
        if (calc.childrenDiscount < 0) m += `${R}×”× ×—×” ×œ×™×œ×“×™× (${R}${children} x ${R}100): ${fmtR(calc.childrenDiscount)} ×©"×—\n`;
        if (calc.percentageDiscount < 0) m += `${R}×”× ×—×” ${R}${params.DSC}%: ${fmtR(calc.percentageDiscount)} ×©"×—\n`;

        m += `\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n`;
        m += `${R}×¡×›×•× ×œ×¤× ×™ ××¢"×: ${fmtR(calc.REV)} ×©"×—\n`;
        m += `${R}××¢"× ${R}18%: ${fmtR(calc.vat)} ×©"×—\n`;
        if ((params.TIP || 0) > 0) m += `${R}×˜×™×¤ ${R}${params.TIP}%: ${fmtR(calc.tip)} ×©"×—\n`;
        m += `\n${R}${boldHebrew('×¡×”"×› ×œ×ª×©×œ×•×:')} ${fmtR(calc.finalTotal)} ×©"×— âœ¨\n\n`;
        m += `${R}× ×©××— ×œ××¨×— ××ª×›×! ğŸ¤\n${R}×—×•×‘×•×ª ×”×œ×‘×‘×•×ª ğŸŒ¿`;
        return m;
      };

      const generateHTMLQuote = (forPdf = false) => {
        const calc = calculatePricing();
        const config = pricingData[eventType];
        const totalGuests = (params.ADT || 0) + (params.CHD || 0);
        const adults = params.ADT || 0;
        const children = params.CHD || 0;
        const eventNames = { PRM: '×¤×¨×™××™×•×', OFS: '××•×¤×¡×™×™×˜', CKT: '×§×•×§×˜×œ×™×', BRC: "×‘×¨×× ×¥'", RNT: '×”×©×›×¨×ª ×—×œ×œ' };

        const now = new Date();
        const dd = String(now.getDate()).padStart(2, '0');
        const mm = String(now.getMonth() + 1).padStart(2, '0');
        const yy = String(now.getFullYear()).slice(-2);
        const hh = String(now.getHours()).padStart(2, '0');
        const min = String(now.getMinutes()).padStart(2, '0');
        const quoteNum = `${dd}${mm}${yy}-${hh}${min}`;
        const fmtH = (num) => Math.round(num).toLocaleString('he-IL');

        const included = [];
        if (config.FOD === '×›×œ×•×œ') included.push('××•×›×œ');
        if (config.FLW === '×›×œ×•×œ') included.push('×¤×¨×—×™×');
        if (config.WIN === '×›×œ×•×œ') included.push('×™×™×Ÿ');

        const extras = [];
        if (params.KSH === '×›×Ÿ') extras.push('×›×©×¨×•×ª ×¨×‘');
        if (params.CRK === '×›×Ÿ') extras.push('×“××™ ×—×œ×™×¦×”');
        if (params.CER === '×›×Ÿ') extras.push('×¡×“× ×ª ×§×¨××™×§×”');
        if (config.FLW !== '×›×œ×•×œ' && params.FLW === '×›×Ÿ') extras.push('×¤×¨×—×™×');
        if (config.WIN !== '×›×œ×•×œ' && params.WIN === '×›×Ÿ') extras.push('×™×™×Ÿ');
        if (params.WINP === '×›×Ÿ') extras.push('×™×™×Ÿ ×¤×¨×™××™×•×');
        if (params.KIT === '×›×Ÿ') extras.push('×©×™××•×© ×‘××˜×‘×—');
        if (config.FOD !== '×›×œ×•×œ' && params.FOD === '×›×Ÿ') extras.push('××•×›×œ');
        if ((params.PRO || 0) > 0) extras.push(`${params.PRO} ×× ×•×ª ×—×œ×‘×•×Ÿ ×œ××“×`);

        let incomeRows = '';
        calc.income.forEach((item, idx) => {
          const bg = idx % 2 === 0 ? 'background:rgba(255,255,255,0.06);' : '';
          incomeRows += `<tr style="${bg}"><td style="padding:11px 20px;color:#e8edf5;font-size:14px;border-bottom:1px solid rgba(255,255,255,0.08);">${item.label}</td><td style="padding:11px 20px;text-align:left;white-space:nowrap;color:#fff;font-weight:700;font-size:14px;border-bottom:1px solid rgba(255,255,255,0.08);direction:ltr;">${fmtH(item.amount)} â‚ª</td></tr>`;
        });
        if (calc.childrenDiscount < 0) {
          incomeRows += `<tr style="background:rgba(255,100,100,0.1);"><td style="padding:11px 20px;color:#ffb3b3;font-size:14px;border-bottom:1px solid rgba(255,255,255,0.08);">×”× ×—×” ×œ×™×œ×“×™× (${children})</td><td style="padding:11px 20px;text-align:left;color:#ffb3b3;font-weight:700;font-size:14px;white-space:nowrap;border-bottom:1px solid rgba(255,255,255,0.08);direction:ltr;">${fmtH(calc.childrenDiscount)} â‚ª</td></tr>`;
        }
        if (calc.percentageDiscount < 0) {
          incomeRows += `<tr style="background:rgba(255,100,100,0.1);"><td style="padding:11px 20px;color:#ffb3b3;font-size:14px;border-bottom:1px solid rgba(255,255,255,0.08);">×”× ×—×” ${params.DSC}%</td><td style="padding:11px 20px;text-align:left;color:#ffb3b3;font-weight:700;font-size:14px;white-space:nowrap;border-bottom:1px solid rgba(255,255,255,0.08);direction:ltr;">${fmtH(calc.percentageDiscount)} â‚ª</td></tr>`;
        }

        let detailRows = '';
        detailRows += `<tr><td style="padding:10px 20px;color:rgba(255,255,255,0.7);font-size:13px;border-bottom:1px solid rgba(255,255,255,0.08);width:140px;">×¡×•×’ ××™×¨×•×¢</td><td style="padding:10px 20px;color:#fff;font-weight:700;font-size:15px;border-bottom:1px solid rgba(255,255,255,0.08);">${eventNames[eventType]}</td></tr>`;
        detailRows += `<tr><td style="padding:10px 20px;color:rgba(255,255,255,0.7);font-size:13px;border-bottom:1px solid rgba(255,255,255,0.08);">××‘×•×’×¨×™×</td><td style="padding:10px 20px;color:#fff;font-weight:700;font-size:15px;border-bottom:1px solid rgba(255,255,255,0.08);">${adults}</td></tr>`;
        if (children > 0) {
          detailRows += `<tr><td style="padding:10px 20px;color:rgba(255,255,255,0.7);font-size:13px;border-bottom:1px solid rgba(255,255,255,0.08);">×™×œ×“×™×</td><td style="padding:10px 20px;color:#fff;font-weight:700;font-size:15px;border-bottom:1px solid rgba(255,255,255,0.08);">${children}</td></tr>`;
        }
        detailRows += `<tr><td style="padding:10px 20px;color:rgba(255,255,255,0.7);font-size:13px;">×¡×”"×› ××©×ª×ª×¤×™×</td><td style="padding:10px 20px;color:#fff;font-weight:700;font-size:15px;">${totalGuests}</td></tr>`;

        return `<!DOCTYPE html>
<html dir="rtl" lang="he">
<head>
<meta charset="UTF-8">
<style>
  @import url('https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;600;700;800&display=swap');
  * { margin:0; padding:0; box-sizing:border-box; }
  body { font-family:'Heebo',sans-serif; background:#2c4d8a; color:#fff; padding:0; direction:rtl; }
  .page { max-width:680px; margin:0 auto; background:#3558A0; min-height:100vh; }
  .header { padding:44px 36px 28px; border-bottom:1px solid rgba(255,255,255,0.12); }
  .header h1 { font-size:22px; font-weight:800; color:#fff; margin-bottom:4px; }
  .header .sub { font-size:14px; color:rgba(255,255,255,0.6); font-weight:300; }
  .section { padding:0 36px; }
  .section-title { font-size:14px; font-weight:700; color:#C8A84E; margin:28px 0 14px; padding-bottom:8px; border-bottom:1px solid rgba(200,168,78,0.3); letter-spacing:0.3px; }
  .detail-table { width:100%; border-collapse:collapse; background:rgba(255,255,255,0.04); border-radius:8px; overflow:hidden; }
  .pricing-table { width:100%; border-collapse:collapse; }
  .summary-box { background:rgba(0,0,0,0.15); border-radius:10px; padding:20px 24px; margin:24px 36px; }
  .summary-row { display:flex; justify-content:space-between; padding:7px 0; font-size:14px; color:rgba(255,255,255,0.85); }
  .summary-row .val { font-weight:700; color:#fff; direction:ltr; unicode-bidi:embed; }
  .summary-row.total { font-size:20px; font-weight:800; color:#C8A84E; border-top:2px solid rgba(200,168,78,0.35); padding-top:14px; margin-top:8px; }
  .summary-row.total .val { color:#C8A84E; }
  .footer { text-align:center; padding:28px 36px; color:rgba(255,255,255,0.5); font-size:12px; font-weight:300; border-top:1px solid rgba(255,255,255,0.08); margin-top:20px; }
  .footer strong { color:rgba(255,255,255,0.8); font-weight:600; }
  .tags-row { display:flex; flex-wrap:wrap; gap:8px; padding:4px 0 0; }
  .tag { background:rgba(255,255,255,0.1); color:#fff; padding:5px 14px; border-radius:16px; font-size:12px; font-weight:400; border:1px solid rgba(255,255,255,0.15); }
</style>
</head>
<body>
<div class="page">
  <div class="header">
    <h1>×”×¦×¢×ª ××—×™×¨ â€“ ×—×•×‘×•×ª ×”×œ×‘×‘×•×ª</h1>
    <div class="sub">××¡×¤×¨ ×”×¦×¢×”: ${quoteNum}</div>
  </div>
  <div class="section">
    <div class="section-title">×¤×¨×˜×™ ×”××™×¨×•×¢</div>
    <table class="detail-table">${detailRows}</table>
    ${included.length > 0 ? `<div class="section-title">×›×œ×•×œ ×‘×—×‘×™×œ×”</div><div class="tags-row">${included.map(i => `<span class="tag">${i}</span>`).join('')}</div>` : ''}
    ${extras.length > 0 ? `<div class="section-title">×ª×•×¡×¤×•×ª</div><div class="tags-row">${extras.map(e => `<span class="tag">${e}</span>`).join('')}</div>` : ''}
    <div class="section-title">×¤×™×¨×•×˜ ×¢×œ×•×™×•×ª</div>
    <table class="pricing-table">${incomeRows}</table>
  </div>
  <div class="summary-box">
    <div class="summary-row"><span>×¡×›×•× ×œ×¤× ×™ ××¢"×</span><span class="val">${fmtH(calc.REV)} â‚ª</span></div>
    <div class="summary-row"><span>××¢"× (18%)</span><span class="val">${fmtH(calc.vat)} â‚ª</span></div>
    ${(params.TIP || 0) > 0 ? `<div class="summary-row"><span>×˜×™×¤ (${params.TIP}%)</span><span class="val">${fmtH(calc.tip)} â‚ª</span></div>` : ''}
    <div class="summary-row total"><span>×¡×”"×› ×œ×ª×©×œ×•×</span><span class="val">${fmtH(calc.finalTotal)} â‚ª</span></div>
  </div>
  <div class="footer"><strong>×—×•×‘×•×ª ×”×œ×‘×‘×•×ª</strong><br>054.8977.896 | hey@hovothalevavot.com | events.hovothalevavot.com</div>
</div>
</body>
</html>`;
      };

      const handleCopyWhatsApp = () => {
        const message = generateWhatsAppMessage();
        navigator.clipboard.writeText(message).then(() => {
          setCopied(true);
          setTimeout(() => setCopied(false), 2500);
        });
      };

      const MAKE_WEBHOOK_URL = 'https://hook.eu1.make.com/6flbk8gxd5hzzlw185u7w1eh6gnc7l1v';

      const uploadToMonday = async (blob, filename) => {
        setMondayStatus('uploading');
        try {
          const base64 = await new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.onload = () => resolve(reader.result.split(',')[1]);
            reader.onerror = reject;
            reader.readAsDataURL(blob);
          });

          await fetch(MAKE_WEBHOOK_URL, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ itemId: mondayItemId, filename, fileBase64: base64 })
          });
          setMondayStatus('success');
          setTimeout(() => setMondayStatus(''), 3000);
        } catch (err) {
          setMondayStatus('error');
          setTimeout(() => setMondayStatus(''), 4000);
        }
      };

      const handleSaveFile = async () => {
        setSaved(true);
        if (!window.html2canvas) {
          const script = document.createElement('script');
          script.src = 'https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js';
          document.head.appendChild(script);
          await new Promise(r => script.onload = r);
        }

        const iframe = document.createElement('iframe');
        iframe.style.cssText = 'position:fixed;left:-9999px;top:-9999px;width:700px;height:1px;';
        document.body.appendChild(iframe);
        iframe.contentDocument.write(generateHTMLQuote());
        iframe.contentDocument.close();

        await new Promise(r => setTimeout(r, 1200));

        const canvas = await window.html2canvas(iframe.contentDocument.querySelector('.page'), {
          scale: 2, backgroundColor: '#3558A0', width: 680
        });

        canvas.toBlob((blob) => {
          const filename = `×”×¦×¢×ª_××—×™×¨_${Date.now()}.png`;
          if (mondayItemId) uploadToMonday(blob, filename);
          else {
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = filename;
            a.click();
          }
          setSaved(false);
        });
        document.body.removeChild(iframe);
      };

      const handleGeneratePDF = () => {
        const win = window.open('', '_blank');
        win.document.write(generateHTMLQuote());
        win.document.close();
        setTimeout(() => win.print(), 500);
      };

      const calc = calculatePricing();
      const config = pricingData[eventType];

      const Toggle = ({ checked, onChange, label, included }) => (
        <label className={`flex items-center gap-2 cursor-pointer px-3 py-2 rounded-lg border-2 transition-all ${included ? 'bg-amber-100 border-amber-300' : (checked ? 'bg-amber-100 border-amber-400' : 'bg-amber-50 border-amber-200')}`}>
          <input type="checkbox" checked={included || checked} onChange={onChange} disabled={included} className="w-4 h-4 accent-amber-600" />
          <span className="text-gray-700 font-semibold text-sm">{label} {included && '(×›×œ×•×œ)'}</span>
        </label>
      );

      return (
        <div className="min-h-screen bg-gradient-to-br from-amber-50 to-orange-50 p-3" dir="rtl">
          <div className="max-w-7xl mx-auto">
            <div className="bg-amber-700 text-white rounded-xl p-5 mb-5 text-center shadow-lg">
              <h1 className="text-2xl font-bold">××¢×¨×›×ª ×ª××—×•×¨ â€“ ×—×•×‘×•×ª ×”×œ×‘×‘×•×ª</h1>
              {mondayItemId && <div className="mt-2 text-xs opacity-80">××—×•×‘×¨ ×œ×¤×¨×™×˜ ××•× ×“×™×™: {mondayItemId}</div>}
            </div>

            <div className="grid grid-cols-1 lg:grid-cols-2 gap-5">
              {/* Inputs */}
              <div className="bg-white rounded-xl shadow p-5">
                <div className="grid grid-cols-5 gap-2 mb-6">
                  {Object.keys(pricingData).map(k => (
                    <button key={k} onClick={() => setEventType(k)} className={`p-2 rounded-lg border-2 text-center ${eventType === k ? 'border-amber-500 bg-amber-50' : 'border-gray-100'}`}>
                      <div className="text-xl">{pricingData[k].icon}</div>
                      <div className="text-[10px] font-bold">{pricingData[k].name.split(' - ')[0]}</div>
                    </button>
                  ))}
                </div>

                <div className="space-y-4">
                  {config.ADT && (
                    <div>
                      <label className="text-sm font-bold block mb-1">××‘×•×’×¨×™×: {params.ADT}</label>
                      <input type="range" min={config.ADT.min} max={config.ADT.max} value={params.ADT} onChange={e => setParams({...params, ADT: parseInt(e.target.value)})} className="w-full accent-amber-600" />
                    </div>
                  )}
                  {config.CHD && (
                    <div>
                      <label className="text-sm font-bold block mb-1">×™×œ×“×™×: {params.CHD}</label>
                      <input type="range" min={config.CHD.min} max={config.CHD.max} value={params.CHD} onChange={e => setParams({...params, CHD: parseInt(e.target.value)})} className="w-full accent-amber-600" />
                    </div>
                  )}
                  <div className="grid grid-cols-2 gap-2">
                    {config.FOD && <Toggle label="××•×›×œ" included={config.FOD === '×›×œ×•×œ'} checked={params.FOD === '×›×Ÿ'} onChange={e => setParams({...params, FOD: e.target.checked ? '×›×Ÿ' : '×œ×'})} />}
                    {config.KSH && <Toggle label="×›×©×¨×•×ª ×¨×‘" checked={params.KSH === '×›×Ÿ'} onChange={e => setParams({...params, KSH: e.target.checked ? '×›×Ÿ' : '×œ×'})} />}
                    {config.CER && <Toggle label="×§×¨××™×§×”" checked={params.CER === '×›×Ÿ'} onChange={e => setParams({...params, CER: e.target.checked ? '×›×Ÿ' : '×œ×'})} />}
                    {config.WINP && <Toggle label="×™×™×Ÿ ×¤×¨×™××™×•×" checked={params.WINP === '×›×Ÿ'} onChange={e => setParams({...params, WINP: e.target.checked ? '×›×Ÿ' : '×œ×'})} />}
                  </div>
                </div>
              </div>

              {/* Summary */}
              <div className="bg-white rounded-xl shadow p-5 flex flex-col">
                <div className="flex-1 space-y-3">
                   <div className="flex justify-between text-xl font-black border-b pb-2">
                     <span>×¡×”"×› ×œ×ª×©×œ×•×</span>
                     <span className="text-green-600">{fmt(calc.finalTotal)} â‚ª</span>
                   </div>
                   <div className="text-sm space-y-1 opacity-80">
                     <div className="flex justify-between"><span>×œ×¤× ×™ ××¢"×</span><span>{fmt(calc.REV)} â‚ª</span></div>
                     <div className="flex justify-between"><span>××¢"×</span><span>{fmt(calc.vat)} â‚ª</span></div>
                     <div className="flex justify-between"><span>×˜×™×¤ ({params.TIP}%)</span><span>{fmt(calc.tip)} â‚ª</span></div>
                   </div>
                </div>

                <div className="mt-6 space-y-2">
                  <button onClick={handleCopyWhatsApp} className="w-full bg-green-500 text-white font-bold py-3 rounded-xl">{copied ? 'âœ… ×”×•×¢×ª×§' : 'ğŸ“± ×”×¢×ª×§ ×œ×•×•×˜×¡××¤'}</button>
                  <button onClick={handleSaveFile} className="w-full bg-amber-500 text-white font-bold py-3 rounded-xl">
                    {mondayStatus === 'uploading' ? 'â³ ××¢×œ×”...' : (mondayItemId ? 'ğŸ“¤ ×©×œ×— ×œ××•× ×“×™×™' : 'ğŸ–¼ï¸ ×©××•×¨ ×›×ª××•× ×”')}
                  </button>
                  <button onClick={handleGeneratePDF} className="w-full bg-blue-600 text-white font-bold py-3 rounded-xl">ğŸ“„ ×”×“×¤×¡ PDF</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      );
    };

    ReactDOM.createRoot(document.getElementById('root')).render(<HVLPricingApp />);
  </script>
</body>
</html>
