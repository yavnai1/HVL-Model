<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>××¢×¨×›×ª ×ª××—×•×¨ â€“ ×—×•×‘×•×ª ×”×œ×‘×‘×•×ª</title>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;600;700;800&display=swap" rel="stylesheet" />
  <style>
    body { font-family: 'Heebo', system-ui, sans-serif; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    const HVLPricingApp = () => {
      const defaultPricingData = {
        PRM: {
          name: 'PRM - ×¤×¨×™××™×•×', icon: 'âœ¨',
          ADT: { min: 15, max: 80, default: 15 },
          CHD: { min: 0, max: 20, default: 0 },
          FOD: '×›×œ×•×œ', KSH: ['×œ×', '×›×Ÿ'], WTR: 'calc', PRO: [0, 1, 2],
          CRK: ['×œ×', '×›×Ÿ'], CER: ['×œ×', '×›×Ÿ'], FLW: '×›×œ×•×œ', WIN: '×›×œ×•×œ',
          WINP: ['×œ×', '×›×Ÿ'], KIT: null,
          DSC: { min: 0, max: 15, default: 0 }, TIP: { min: 0, max: 15, default: 15 },
          IBASE: 9900, IMORE: 550, ICRK: 1000, IPRO: 75,
          OPRO1_15: 30, OPRO1_over: 15, OPRO2: 20,
          ICER: 350, OCER: 175, IWINP: 60, OWINP: 10,
          IKIT: null, OKIT: null,
          IFLW: '×›×œ×•×œ', OFLW: 800, IWIN: '×›×œ×•×œ', OWIN: 20,
          IKSH: 1500, OKSH: 1000,
          OCHEFB: 2100, OCHEF1: 40, OCHEF2: null,
          OFOD: 70, OCLEAN: 500, OEVM: 700, OWTR: 400, OOVH: 750
        },
        OFS: {
          name: 'OFS - ××•×¤×¡×™×™×˜', icon: 'ğŸ•ï¸',
          ADT: { min: 10, max: 70, default: 10 }, CHD: null,
          FOD: ['×œ×', '×›×Ÿ'], KSH: ['×œ×', '×›×Ÿ'], WTR: [0, 1, 2], PRO: [0, 1, 2],
          CRK: ['×œ×', '×›×Ÿ'], CER: ['×œ×', '×›×Ÿ'], FLW: ['×œ×', '×›×Ÿ'], WIN: ['×œ×', '×›×Ÿ'],
          WINP: null, KIT: ['×œ×', '×›×Ÿ'],
          DSC: { min: 0, max: 15, default: 0 }, TIP: { min: 0, max: 15, default: 15 },
          IBASE: 5500, IMORE: 500, ICRK: 1000, IPRO: 75,
          OPRO1_15: 30, OPRO1_over: 15, OPRO2: 20,
          ICER: 350, OCER: 175, IWINP: null, OWINP: null,
          IKIT: 150, OKIT: 0,
          IFLW: 1200, OFLW: 800, IWIN: 70, OWIN: 20,
          IKSH: 1500, OKSH: 1000,
          OCHEFB: 1200, OCHEF1: null, OCHEF2: 30,
          OFOD: 70, OCLEAN: 500, OEVM: 700, OWTR: 400, OOVH: 750
        },
        CKT: {
          name: 'CKT - ×§×•×§×˜×œ×™×', icon: 'ğŸ¸',
          ADT: { min: 15, max: 80, default: 15 },
          CHD: { min: 0, max: 20, default: 0 },
          FOD: '×›×œ×•×œ', KSH: ['×œ×', '×›×Ÿ'], WTR: 'calc', PRO: [0, 1, 2],
          CRK: ['×œ×', '×›×Ÿ'], CER: ['×œ×', '×›×Ÿ'], FLW: '×›×œ×•×œ', WIN: '×›×œ×•×œ',
          WINP: ['×œ×', '×›×Ÿ'], KIT: null,
          DSC: { min: 0, max: 15, default: 0 }, TIP: { min: 0, max: 15, default: 15 },
          IBASE: 7050, IMORE: 470, ICRK: 1000, IPRO: 75,
          OPRO1_15: 30, OPRO1_over: 15, OPRO2: 20,
          ICER: 350, OCER: 175, IWINP: 60, OWINP: 10,
          IKIT: null, OKIT: null,
          IFLW: '×›×œ×•×œ', OFLW: 800, IWIN: '×›×œ×•×œ', OWIN: 20,
          IKSH: 1500, OKSH: 1000,
          OCHEFB: 1400, OCHEF1: 40, OCHEF2: null,
          OFOD: 55, OCLEAN: 500, OEVM: 700, OWTR: 400, OOVH: 750
        },
        BRC: {
          name: "BRC - ×‘×¨×× ×¥'", icon: 'ğŸ¥',
          ADT: { min: 15, max: 80, default: 15 },
          CHD: { min: 0, max: 20, default: 0 },
          FOD: '×›×œ×•×œ', KSH: ['×œ×', '×›×Ÿ'], WTR: 'calc', PRO: [0, 1, 2],
          CRK: ['×œ×', '×›×Ÿ'], CER: ['×œ×', '×›×Ÿ'], FLW: '×›×œ×•×œ', WIN: '×›×œ×•×œ',
          WINP: ['×œ×', '×›×Ÿ'], KIT: null,
          DSC: { min: 0, max: 15, default: 0 }, TIP: { min: 0, max: 15, default: 15 },
          IBASE: 8250, IMORE: 500, ICRK: 1000, IPRO: 75,
          OPRO1_15: 30, OPRO1_over: 15, OPRO2: 20,
          ICER: 350, OCER: 175, IWINP: 60, OWINP: 10,
          IKIT: null, OKIT: null,
          IFLW: 1200, OFLW: 800, IWIN: '×›×œ×•×œ', OWIN: 20,
          IKSH: 1500, OKSH: 1000,
          OCHEFB: 1400, OCHEF1: 40, OCHEF2: null,
          OFOD: 70, OCLEAN: 500, OEVM: 700, OWTR: 400, OOVH: 750
        },
        RNT: {
          name: 'RNT - ×”×©×›×¨×ª ×—×œ×œ', icon: 'ğŸ›ï¸',
          ADT: { min: 15, max: 80, default: 15 },
          CHD: { min: 0, max: 20, default: 0 },
          FOD: null, KSH: null, WTR: [0, 1, 2], PRO: [0, 1, 2],
          CRK: null, CER: null, FLW: ['×œ×', '×›×Ÿ'], WIN: ['×œ×', '×›×Ÿ'],
          WINP: null, KIT: ['×œ×', '×›×Ÿ'],
          DSC: { min: 0, max: 15, default: 0 }, TIP: { min: 0, max: 15, default: 15 },
          IBASE: 5500, IMORE_per10: 1000,
          ICRK: null, IPRO: 75,
          OPRO1_15: 30, OPRO1_over: 15, OPRO2: 20,
          ICER: null, OCER: null, IWINP: null, OWINP: null,
          IKIT: 1000, OKIT: 0,
          IFLW: 1200, OFLW: 800, IWIN: 70, OWIN: 20,
          IKSH: null, OKSH: null,
          OCHEFB: null, OCHEF1: null, OCHEF2: null,
          OFOD: null, OCLEAN: 500, OEVM: 700, OWTR: 400, OOVH: null
        }
      };

      const [pricingData] = useState(defaultPricingData);
      const [eventType, setEventType] = useState('PRM');
      const [params, setParams] = useState({});

      // ========== MONDAY INTEGRATION ==========
      const urlParams = new URLSearchParams(window.location.search);
      const mondayItemId = urlParams.get('itemId');
      const mondayBoardId = urlParams.get('boardId');

      const [copied, setCopied] = useState(false);
      const [showPreview, setShowPreview] = useState(false);
      const [pdfLoading, setPdfLoading] = useState(false);

      useEffect(() => {
        const config = pricingData[eventType];
        setParams({
          ADT: config.ADT ? config.ADT.default : 0,
          CHD: config.CHD ? config.CHD.default : 0,
          FOD: config.FOD === '×›×œ×•×œ' ? '×›×Ÿ' : (Array.isArray(config.FOD) ? config.FOD[0] : null),
          KSH: Array.isArray(config.KSH) ? config.KSH[0] : null,
          WTR: 0,
          PRO: Array.isArray(config.PRO) ? config.PRO[0] : 0,
          CRK: Array.isArray(config.CRK) ? config.CRK[0] : null,
          CER: Array.isArray(config.CER) ? config.CER[0] : null,
          FLW: config.FLW === '×›×œ×•×œ' ? '×›×Ÿ' : (Array.isArray(config.FLW) ? config.FLW[0] : null),
          WIN: config.WIN === '×›×œ×•×œ' ? '×›×Ÿ' : (Array.isArray(config.WIN) ? config.WIN[0] : null),
          WINP: Array.isArray(config.WINP) ? config.WINP[0] : null,
          KIT: Array.isArray(config.KIT) ? config.KIT[0] : null,
          DSC: config.DSC ? config.DSC.default : 0,
          TIP: config.TIP ? config.TIP.default : 15
        });
      }, [eventType]);

      const calculateWaiters = () => {
        const config = pricingData[eventType];
        const totalGuests = (params.ADT || 0) + (params.CHD || 0);
        if (config.WTR === 'calc') return Math.ceil(totalGuests / 20);
        if (Array.isArray(config.WTR)) return params.WTR || 0;
        return 0;
      };

      const calculatePricing = () => {
        const config = pricingData[eventType];
        const totalGuests = (params.ADT || 0) + (params.CHD || 0);
        const adults = params.ADT || 0;
        const children = params.CHD || 0;
        let income = [], outcome = [];

        income.push({ label: '×—×‘×™×œ×ª ×‘×¡×™×¡ (×¢×“ 15 ×× ×©×™×)', amount: config.IBASE });

        if (eventType === 'RNT' && config.IMORE_per10) {
          const extra = Math.max(0, totalGuests - 15);
          const groups = Math.ceil(extra / 10);
          if (groups > 0) income.push({ label: `×ª×•×¡×¤×ª ××•×¨×—×™× (${groups * 10} ×× ×©×™×)`, amount: groups * config.IMORE_per10 });
        } else if (config.IMORE && totalGuests > 15) {
          const extra = totalGuests - 15;
          income.push({ label: `×ª×•×¡×¤×ª ××•×¨×—×™× (${extra} Ã— ${config.IMORE} ×©"×—)`, amount: extra * config.IMORE });
        }

        if (params.CRK === '×›×Ÿ' && config.ICRK) income.push({ label: '×“××™ ×—×œ×™×¦×”', amount: config.ICRK });

        if (eventType === 'OFS' && params.FOD === '×›×Ÿ') {
          income.push({ label: `××•×›×œ (${totalGuests} Ã— 500 ×©"×—)`, amount: totalGuests * 500 });
        }

        if (params.PRO > 0 && config.IPRO) {
          income.push({ label: `×ª×•×¡×¤×ª ${params.PRO} ×× ×•×ª ×—×œ×‘×•×Ÿ (${totalGuests} Ã— ${params.PRO} Ã— ${config.IPRO} ×©"×—)`, amount: params.PRO * totalGuests * config.IPRO });
          const first15 = Math.min(totalGuests, 15), over15 = Math.max(0, totalGuests - 15);
          outcome.push({ label: `×¢×œ×•×ª ×—×œ×‘×•×Ÿ - ×—×•××¨ ×’×œ×`, amount: -(params.PRO * ((first15 * config.OPRO1_15) + (over15 * config.OPRO1_over))) });
          outcome.push({ label: `×¢×œ×•×ª ×—×œ×‘×•×Ÿ - ××•×¢×‘×¨ ×œ×©×£`, amount: -(params.PRO * totalGuests * config.OPRO2) });
        }

        if (params.CER === '×›×Ÿ' && config.ICER) {
          income.push({ label: `×¡×“× ×ª ×§×¨××™×§×” (${totalGuests} Ã— ${config.ICER} ×©"×—)`, amount: totalGuests * config.ICER });
          outcome.push({ label: `×¢×œ×•×ª ×¡×“× ×ª ×§×¨××™×§×”`, amount: -totalGuests * config.OCER });
        }

        if (params.WINP === '×›×Ÿ' && config.IWINP) {
          income.push({ label: `×ª×•×¡×¤×ª ×™×™×Ÿ ×¤×¨×™××™×•× (${adults} Ã— ${config.IWINP} ×©"×—)`, amount: adults * config.IWINP });
          outcome.push({ label: `×¢×œ×•×ª ×™×™×Ÿ ×¤×¨×™××™×•×`, amount: -adults * config.OWINP });
        }

        if (params.KIT === '×›×Ÿ' && config.IKIT) income.push({ label: '×©×™××•×© ×‘××˜×‘×—', amount: config.IKIT });

        if (config.IFLW !== '×›×œ×•×œ' && params.FLW === '×›×Ÿ' && config.IFLW) income.push({ label: '×¤×¨×—×™×', amount: config.IFLW });
        if (params.FLW === '×›×Ÿ' || config.FLW === '×›×œ×•×œ') outcome.push({ label: '×¢×œ×•×ª ×¤×¨×—×™×', amount: -config.OFLW });

        if (config.WIN !== '×›×œ×•×œ' && config.IWIN !== '×›×œ×•×œ' && params.WIN === '×›×Ÿ' && config.IWIN) income.push({ label: `×™×™×Ÿ (${adults} Ã— ${config.IWIN} ×©"×—)`, amount: adults * config.IWIN });
        if (params.WIN === '×›×Ÿ' || config.WIN === '×›×œ×•×œ') outcome.push({ label: `×¢×œ×•×ª ×™×™×Ÿ`, amount: -adults * config.OWIN });

        if (params.KSH === '×›×Ÿ' && config.IKSH) {
          income.push({ label: '×”×›×©×¨×ª ×¨×‘', amount: config.IKSH });
          outcome.push({ label: '×¢×œ×•×ª ×”×›×©×¨×ª ×¨×‘', amount: -config.OKSH });
        }

        if (config.OCHEFB) {
          outcome.push({ label: '×©×£ ×‘×¡×™×¡', amount: -config.OCHEFB });
          if (config.OCHEF1 && totalGuests > 35) outcome.push({ label: `×©×£ ×ª×•×¡×¤×ª`, amount: -(totalGuests - 35) * config.OCHEF1 });
          if (config.OCHEF2 && totalGuests > 10) outcome.push({ label: `×©×£ ×ª×•×¡×¤×ª`, amount: -(totalGuests - 10) * config.OCHEF2 });
        }

        const cookDiv = eventType === 'PRM' ? 20 : 28;
        const cooks = Math.floor(totalGuests / cookDiv);
        if (cooks > 0 && config.OFOD !== null) outcome.push({ label: `×˜×‘×— × ×•×¡×£ (${cooks})`, amount: -cooks * 500 });

        if (config.OFOD && (params.FOD === '×›×Ÿ' || config.FOD === '×›×œ×•×œ')) outcome.push({ label: `×¢×œ×•×ª ××•×›×œ`, amount: -totalGuests * config.OFOD });

        if (config.OCLEAN) outcome.push({ label: '× ×§×™×•×Ÿ', amount: -config.OCLEAN });
        if (config.OEVM) outcome.push({ label: '×× ×”×œ ××™×¨×•×¢', amount: -config.OEVM });

        const waiters = calculateWaiters();
        if (waiters > 0 && config.OWTR) outcome.push({ label: `××œ×¦×¨×™× (${waiters})`, amount: -waiters * config.OWTR });
        if (config.OOVH) outcome.push({ label: '×ª×§×•×¨×” ×§×‘×•×¢×”', amount: -config.OOVH });

        const totalIncome = income.reduce((s, i) => s + i.amount, 0);
        let childrenDiscount = children > 0 ? -children * 100 : 0;
        let percentageDiscount = params.DSC > 0 ? -(totalIncome * params.DSC / 100) : 0;
        const REV = totalIncome + childrenDiscount + percentageDiscount;
        const salesBonus = -REV * 0.03;
        outcome.push({ label: '×‘×•× ×•×¡ ×× ×”×œ ××›×™×¨×•×ª (3%)', amount: salesBonus });
        const totalOutcome = outcome.reduce((s, i) => s + i.amount, 0);
        const COG = totalOutcome;
        const GDP = REV + COG;
        const vat = REV * 0.18;
        const tip = (REV + vat) * (params.TIP / 100);
        const finalTotal = REV + vat + tip;

        return { income, outcome, childrenDiscount, percentageDiscount, REV, COG, GDP, vat, tip, finalTotal };
      };

      const fmt = (num) => Math.round(num).toLocaleString('he-IL');
      const R = '\u200F';
      const fmtR = (num) => `${R}${Math.round(num).toLocaleString('he-IL')}`;
      const boldHebrew = (text) => `*${text}*`;

      const generateWhatsAppMessage = () => {
        const calc = calculatePricing();
        const config = pricingData[eventType];
        const totalGuests = (params.ADT || 0) + (params.CHD || 0);
        const adults = params.ADT || 0;
        const children = params.CHD || 0;
        const eventNames = { PRM: '×¤×¨×™××™×•×', OFS: '××•×¤×¡×™×™×˜', CKT: '×§×•×§×˜×œ×™×', BRC: "×‘×¨×× ×¥'", RNT: '×”×©×›×¨×ª ×—×œ×œ' };

        const now = new Date();
        const dd = String(now.getDate()).padStart(2, '0');
        const mm = String(now.getMonth() + 1).padStart(2, '0');
        const yy = String(now.getFullYear()).slice(-2);
        const hh = String(now.getHours()).padStart(2, '0');
        const min = String(now.getMinutes()).padStart(2, '0');
        const quoteNum = `${dd}${mm}${yy}-${hh}${min}`;

        let m = '';
        m += `${R}${boldHebrew('×”×¦×¢×ª ××—×™×¨ ×—×•×‘×•×ª ×”×œ×‘×‘×•×ª')} ğŸŒ¿\n`;
        m += `${R}×”×¦×¢×” ××¡×¤×¨: ${R}${quoteNum}\n`;
        m += `â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n\n`;
        m += `${R}${boldHebrew('×¤×¨×˜×™ ×”××™×¨×•×¢')} ğŸ“‹\n`;
        m += `${R}×¡×•×’: ${eventNames[eventType]}\n`;
        m += `${R}××‘×•×’×¨×™×: ${R}${adults}`;
        if (children > 0) m += ` | ×™×œ×“×™×: ${R}${children}`;
        m += `\n${R}×¡×”"×› ××©×ª×ª×¤×™×: ${R}${totalGuests}\n`;

        const included = [];
        if (config.FOD === '×›×œ×•×œ') included.push('××•×›×œ ğŸ½ï¸');
        if (config.FLW === '×›×œ×•×œ') included.push('×¤×¨×—×™× ğŸ’');
        if (config.WIN === '×›×œ×•×œ') included.push('×™×™×Ÿ ğŸ·');
        if (included.length > 0) m += `\n${R}${boldHebrew('×›×œ×•×œ ×‘×—×‘×™×œ×”:')} ${included.join(', ')}\n`;

        const extras = [];
        if (params.KSH === '×›×Ÿ') extras.push('×›×©×¨×•×ª ×¨×‘');
        if (params.CRK === '×›×Ÿ') extras.push('×“××™ ×—×œ×™×¦×”');
        if (params.CER === '×›×Ÿ') extras.push('×¡×“× ×ª ×§×¨××™×§×” ğŸ¨');
        if (config.FLW !== '×›×œ×•×œ' && params.FLW === '×›×Ÿ') extras.push('×¤×¨×—×™× ğŸ’');
        if (config.WIN !== '×›×œ×•×œ' && params.WIN === '×›×Ÿ') extras.push('×™×™×Ÿ ğŸ·');
        if (params.WINP === '×›×Ÿ') extras.push('×™×™×Ÿ ×¤×¨×™××™×•× ğŸ¥‚');
        if (params.KIT === '×›×Ÿ') extras.push('×©×™××•×© ×‘××˜×‘×—');
        if (config.FOD !== '×›×œ×•×œ' && params.FOD === '×›×Ÿ') extras.push('××•×›×œ ğŸ½ï¸');
        if ((params.PRO || 0) > 0) extras.push(`${R}${params.PRO} ×× ×•×ª ×—×œ×‘×•×Ÿ ×œ××“× ğŸ¥©`);
        if (extras.length > 0) {
          m += `\n${R}${boldHebrew('×ª×•×¡×¤×•×ª:')} âœ…\n`;
          extras.forEach(e => { m += `${R}â€¢ ${e}\n`; });
        }

        m += `\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n`;
        m += `${R}${boldHebrew('×¤×™×¨×•×˜ ×¢×œ×•×™×•×ª')} ğŸ’°\n\n`;
        calc.income.forEach(item => { m += `${R}${item.label}: ${fmtR(item.amount)} ×©"×—\n`; });
        if (calc.childrenDiscount < 0) m += `${R}×”× ×—×” ×œ×™×œ×“×™× (${R}${children} x ${R}100): ${fmtR(calc.childrenDiscount)} ×©"×—\n`;
        if (calc.percentageDiscount < 0) m += `${R}×”× ×—×” ${R}${params.DSC}%: ${fmtR(calc.percentageDiscount)} ×©"×—\n`;

        m += `\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n`;
        m += `${R}×¡×›×•× ×œ×¤× ×™ ××¢"×: ${fmtR(calc.REV)} ×©"×—\n`;
        m += `${R}××¢"× ${R}18%: ${fmtR(calc.vat)} ×©"×—\n`;
        if ((params.TIP || 0) > 0) m += `${R}×˜×™×¤ ${R}${params.TIP}%: ${fmtR(calc.tip)} ×©"×—\n`;
        m += `\n${R}${boldHebrew('×¡×”"×› ×œ×ª×©×œ×•×:')} ${fmtR(calc.finalTotal)} ×©"×— âœ¨\n\n`;
        m += `${R}× ×©××— ×œ××¨×— ××ª×›×! ğŸ¤\n${R}×—×•×‘×•×ª ×”×œ×‘×‘×•×ª ğŸŒ¿`;
        return m;
      };

      const generateHTMLQuote = (forPdf = false) => {
        const calc = calculatePricing();
        const config = pricingData[eventType];
        const totalGuests = (params.ADT || 0) + (params.CHD || 0);
        const adults = params.ADT || 0;
        const children = params.CHD || 0;
        const eventNames = { PRM: '×¤×¨×™××™×•×', OFS: '××•×¤×¡×™×™×˜', CKT: '×§×•×§×˜×œ×™×', BRC: "×‘×¨×× ×¥'", RNT: '×”×©×›×¨×ª ×—×œ×œ' };

        const now = new Date();
        const dd = String(now.getDate()).padStart(2, '0');
        const mm = String(now.getMonth() + 1).padStart(2, '0');
        const yy = String(now.getFullYear()).slice(-2);
        const hh = String(now.getHours()).padStart(2, '0');
        const min = String(now.getMinutes()).padStart(2, '0');
        const quoteNum = `${dd}${mm}${yy}-${hh}${min}`;
        const fmtH = (num) => Math.round(num).toLocaleString('he-IL');

        const included = [];
        if (config.FOD === '×›×œ×•×œ') included.push('××•×›×œ');
        if (config.FLW === '×›×œ×•×œ') included.push('×¤×¨×—×™×');
        if (config.WIN === '×›×œ×•×œ') included.push('×™×™×Ÿ');

        const extras = [];
        if (params.KSH === '×›×Ÿ') extras.push('×›×©×¨×•×ª ×¨×‘');
        if (params.CRK === '×›×Ÿ') extras.push('×“××™ ×—×œ×™×¦×”');
        if (params.CER === '×›×Ÿ') extras.push('×¡×“× ×ª ×§×¨××™×§×”');
        if (config.FLW !== '×›×œ×•×œ' && params.FLW === '×›×Ÿ') extras.push('×¤×¨×—×™×');
        if (config.WIN !== '×›×œ×•×œ' && params.WIN === '×›×Ÿ') extras.push('×™×™×Ÿ');
        if (params.WINP === '×›×Ÿ') extras.push('×™×™×Ÿ ×¤×¨×™××™×•×');
        if (params.KIT === '×›×Ÿ') extras.push('×©×™××•×© ×‘××˜×‘×—');
        if (config.FOD !== '×›×œ×•×œ' && params.FOD === '×›×Ÿ') extras.push('××•×›×œ');
        if ((params.PRO || 0) > 0) extras.push(`${params.PRO} ×× ×•×ª ×—×œ×‘×•×Ÿ ×œ××“×`);

        let incomeRows = '';
        calc.income.forEach((item, idx) => {
          const bg = idx % 2 === 0 ? 'background:rgba(255,255,255,0.06);' : '';
          incomeRows += `<tr style="${bg}"><td style="padding:11px 20px;color:#e8edf5;font-size:14px;border-bottom:1px solid rgba(255,255,255,0.08);">${item.label}</td><td style="padding:11px 20px;text-align:left;white-space:nowrap;color:#fff;font-weight:700;font-size:14px;border-bottom:1px solid rgba(255,255,255,0.08);direction:ltr;">${fmtH(item.amount)} â‚ª</td></tr>`;
        });
        if (calc.childrenDiscount < 0) {
          incomeRows += `<tr style="background:rgba(255,100,100,0.1);"><td style="padding:11px 20px;color:#ffb3b3;font-size:14px;border-bottom:1px solid rgba(255,255,255,0.08);">×”× ×—×” ×œ×™×œ×“×™× (${children})</td><td style="padding:11px 20px;text-align:left;color:#ffb3b3;font-weight:700;font-size:14px;white-space:nowrap;border-bottom:1px solid rgba(255,255,255,0.08);direction:ltr;">${fmtH(calc.childrenDiscount)} â‚ª</td></tr>`;
        }
        if (calc.percentageDiscount < 0) {
          incomeRows += `<tr style="background:rgba(255,100,100,0.1);"><td style="padding:11px 20px;color:#ffb3b3;font-size:14px;border-bottom:1px solid rgba(255,255,255,0.08);">×”× ×—×” ${params.DSC}%</td><td style="padding:11px 20px;text-align:left;color:#ffb3b3;font-weight:700;font-size:14px;white-space:nowrap;border-bottom:1px solid rgba(255,255,255,0.08);direction:ltr;">${fmtH(calc.percentageDiscount)} â‚ª</td></tr>`;
        }

        let detailRows = '';
        detailRows += `<tr><td style="padding:10px 20px;color:rgba(255,255,255,0.7);font-size:13px;border-bottom:1px solid rgba(255,255,255,0.08);width:140px;">×¡×•×’ ××™×¨×•×¢</td><td style="padding:10px 20px;color:#fff;font-weight:700;font-size:15px;border-bottom:1px solid rgba(255,255,255,0.08);">${eventNames[eventType]}</td></tr>`;
        detailRows += `<tr><td style="padding:10px 20px;color:rgba(255,255,255,0.7);font-size:13px;border-bottom:1px solid rgba(255,255,255,0.08);">××‘×•×’×¨×™×</td><td style="padding:10px 20px;color:#fff;font-weight:700;font-size:15px;border-bottom:1px solid rgba(255,255,255,0.08);">${adults}</td></tr>`;
        if (children > 0) {
          detailRows += `<tr><td style="padding:10px 20px;color:rgba(255,255,255,0.7);font-size:13px;border-bottom:1px solid rgba(255,255,255,0.08);">×™×œ×“×™×</td><td style="padding:10px 20px;color:#fff;font-weight:700;font-size:15px;border-bottom:1px solid rgba(255,255,255,0.08);">${children}</td></tr>`;
        }
        detailRows += `<tr><td style="padding:10px 20px;color:rgba(255,255,255,0.7);font-size:13px;">×¡×”"×› ××©×ª×ª×¤×™×</td><td style="padding:10px 20px;color:#fff;font-weight:700;font-size:15px;">${totalGuests}</td></tr>`;

        const printStyles = forPdf ? `
        @media print {
          body { padding:0; margin:0; }
          .page { box-shadow:none; border-radius:0; max-width:100%; }
        }
        @page { size:A4; margin:10mm; }` : '';

        return `<!DOCTYPE html>
<html dir="rtl" lang="he">
<head>
<meta charset="UTF-8">
<title>×”×¦×¢×ª ××—×™×¨ ${quoteNum} - ×—×•×‘×•×ª ×”×œ×‘×‘×•×ª</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;600;700;800&display=swap');
  * { margin:0; padding:0; box-sizing:border-box; }
  body { font-family:'Heebo',sans-serif; background:#2c4d8a; color:#fff; padding:0; direction:rtl; }
  .page { max-width:680px; margin:0 auto; background:#3558A0; min-height:100vh; }
  .header { padding:44px 36px 28px; border-bottom:1px solid rgba(255,255,255,0.12); }
  .header h1 { font-size:22px; font-weight:800; color:#fff; margin-bottom:4px; }
  .header .sub { font-size:14px; color:rgba(255,255,255,0.6); font-weight:300; }
  .section { padding:0 36px; }
  .section-title { font-size:14px; font-weight:700; color:#C8A84E; margin:28px 0 14px; padding-bottom:8px; border-bottom:1px solid rgba(200,168,78,0.3); letter-spacing:0.3px; }
  .detail-table { width:100%; border-collapse:collapse; background:rgba(255,255,255,0.04); border-radius:8px; overflow:hidden; }
  .pricing-table { width:100%; border-collapse:collapse; }
  .summary-box { background:rgba(0,0,0,0.15); border-radius:10px; padding:20px 24px; margin:24px 36px; }
  .summary-row { display:flex; justify-content:space-between; padding:7px 0; font-size:14px; color:rgba(255,255,255,0.85); }
  .summary-row .val { font-weight:700; color:#fff; direction:ltr; unicode-bidi:embed; }
  .summary-row.total { font-size:20px; font-weight:800; color:#C8A84E; border-top:2px solid rgba(200,168,78,0.35); padding-top:14px; margin-top:8px; }
  .summary-row.total .val { color:#C8A84E; }
  .footer { text-align:center; padding:28px 36px; color:rgba(255,255,255,0.5); font-size:12px; font-weight:300; border-top:1px solid rgba(255,255,255,0.08); margin-top:20px; }
  .footer strong { color:rgba(255,255,255,0.8); font-weight:600; }
  .tags-row { display:flex; flex-wrap:wrap; gap:8px; padding:4px 0 0; }
  .tag { background:rgba(255,255,255,0.1); color:#fff; padding:5px 14px; border-radius:16px; font-size:12px; font-weight:400; border:1px solid rgba(255,255,255,0.15); }
  ${printStyles}
</style>
</head>
<body>
<div class="page">
  <div class="header">
    <h1>×”×¦×¢×ª ××—×™×¨ â€“ ×—×•×‘×•×ª ×”×œ×‘×‘×•×ª</h1>
    <div class="sub">××¡×¤×¨ ×”×¦×¢×”: ${quoteNum}</div>
  </div>
  <div class="section">
    <div class="section-title">×¤×¨×˜×™ ×”××™×¨×•×¢</div>
    <table class="detail-table">${detailRows}</table>
    ${included.length > 0 ? `<div class="section-title">×›×œ×•×œ ×‘×—×‘×™×œ×”</div><div class="tags-row">${included.map(i => `<span class="tag">${i}</span>`).join('')}</div>` : ''}
    ${extras.length > 0 ? `<div class="section-title">×ª×•×¡×¤×•×ª</div><div class="tags-row">${extras.map(e => `<span class="tag">${e}</span>`).join('')}</div>` : ''}
    <div class="section-title">×¤×™×¨×•×˜ ×¢×œ×•×™×•×ª</div>
    <table class="pricing-table">${incomeRows}</table>
  </div>
  <div class="summary-box">
    <div class="summary-row"><span>×¡×›×•× ×œ×¤× ×™ ××¢"×</span><span class="val">${fmtH(calc.REV)} â‚ª</span></div>
    <div class="summary-row"><span>××¢"× (18%)</span><span class="val">${fmtH(calc.vat)} â‚ª</span></div>
    ${(params.TIP || 0) > 0 ? `<div class="summary-row"><span>×˜×™×¤ (${params.TIP}%)</span><span class="val">${fmtH(calc.tip)} â‚ª</span></div>` : ''}
    <div class="summary-row total"><span>×¡×”"×› ×œ×ª×©×œ×•×</span><span class="val">${fmtH(calc.finalTotal)} â‚ª</span></div>
  </div>
  <div class="footer"><strong>×—×•×‘×•×ª ×”×œ×‘×‘×•×ª</strong><br>054.8977.896 | hey@hovothalevavot.com | events.hovothalevavot.com</div>
</div>
</body>
</html>`;
      };

      const handleCopyWhatsApp = () => {
        const message = generateWhatsAppMessage();
        const ta = document.createElement('textarea');
        ta.value = message;
        ta.style.cssText = 'position:fixed;left:-9999px;top:-9999px';
        document.body.appendChild(ta);
        ta.focus();
        ta.select();
        try {
          document.execCommand('copy');
          setCopied(true);
          setTimeout(() => setCopied(false), 2500);
        } catch (err) {
          if (navigator.clipboard) {
            navigator.clipboard.writeText(message).then(() => {
              setCopied(true);
              setTimeout(() => setCopied(false), 2500);
            });
          }
        }
        document.body.removeChild(ta);
      };

      const [saved, setSaved] = useState(false);
      const [mondayStatus, setMondayStatus] = useState('');

      // ========== MONDAY UPLOAD ==========
      // ========== MONDAY UPLOAD via Make Webhook ==========
      const MAKE_WEBHOOK_URL = 'https://hook.eu1.make.com/6flbk8gxd5hzzlw185u7w1eh6gnc7l1v';

      const uploadToMonday = async (blob, filename) => {
        setMondayStatus('uploading');
        try {
          const base64 = await new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.onload = () => resolve(reader.result.split(',')[1]);
            reader.onerror = reject;
            reader.readAsDataURL(blob);
          });

          const res = await fetch(MAKE_WEBHOOK_URL, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              itemId: mondayItemId,
              filename: filename,
              fileBase64: base64
            })
          });

          if (!res.ok) throw new Error('Webhook error: ' + res.status);
          setMondayStatus('success');
          setTimeout(() => setMondayStatus(''), 3000);
        } catch (err) {
          console.error('Monday upload failed:', err);
          setMondayStatus('error');
          setTimeout(() => setMondayStatus(''), 4000);
        }
      };
        setMondayStatus('uploading');
        try {
          const formData = new FormData();
          const query = `mutation ($file: File!) { add_file_to_column(item_id: ${mondayItemId}, column_id: "file_mm0nenx4", file: $file) { id } }`;
          formData.append('query', query);
          formData.append('variables[file]', blob, filename);

          const res = await fetch('https://api.monday.com/v2/file', {
            method: 'POST',
            headers: { 'Authorization': token },
            body: formData
          });
          const data = await res.json();
          if (data.errors) throw new Error(data.errors[0].message);
          setMondayStatus('success');
          setTimeout(() => setMondayStatus(''), 3000);
        } catch (err) {
          console.error('Monday upload failed:', err);
          setMondayStatus('error');
          setTimeout(() => setMondayStatus(''), 4000);
        }
      };

      const handleSaveFile = async () => {
        setSaved(true);
        const html = generateHTMLQuote();

        if (!window.html2canvas) {
          const script = document.createElement('script');
          script.src = 'https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js';
          document.head.appendChild(script);
          await new Promise((resolve, reject) => { script.onload = resolve; script.onerror = reject; });
        }

        const iframe = document.createElement('iframe');
        iframe.style.cssText = 'position:fixed;left:-9999px;top:-9999px;width:700px;height:1px;border:none;';
        document.body.appendChild(iframe);

        const doc = iframe.contentDocument;
        doc.open();
        doc.write(html);
        doc.close();

        await new Promise(r => setTimeout(r, 1200));

        const pageEl = doc.querySelector('.page');
        const targetEl = pageEl || doc.body;

        try {
          const canvas = await window.html2canvas(targetEl, {
            scale: 2, useCORS: true, allowTaint: true,
            backgroundColor: '#3558A0', width: 680, windowWidth: 700, logging: false,
          });

          canvas.toBlob((blob) => {
            const now = new Date();
            const dd = String(now.getDate()).padStart(2, '0');
            const mm = String(now.getMonth() + 1).padStart(2, '0');
            const yy = String(now.getFullYear()).slice(-2);
            const hh = String(now.getHours()).padStart(2, '0');
            const min = String(now.getMinutes()).padStart(2, '0');
            const filename = `×”×¦×¢×ª_××—×™×¨_${dd}${mm}${yy}_${hh}${min}.png`;

            document.body.removeChild(iframe);

            if (mondayItemId) {
              uploadToMonday(blob, filename);
            } else {
              const url = URL.createObjectURL(blob);
              const a = document.createElement('a');
              a.href = url;
              a.download = filename;
              document.body.appendChild(a);
              a.click();
              document.body.removeChild(a);
              URL.revokeObjectURL(url);
            }
            setTimeout(() => setSaved(false), 2500);
          }, 'image/png');
        } catch (err) {
          console.error('html2canvas failed, using fallback:', err);
          document.body.removeChild(iframe);
          generatePNGFallback();
          setTimeout(() => setSaved(false), 2500);
        }
      };

      const generatePNGFallback = () => {
        const calc = calculatePricing();
        const config = pricingData[eventType];
        const totalGuests = (params.ADT || 0) + (params.CHD || 0);
        const adults = params.ADT || 0;
        const children = params.CHD || 0;
        const eventNames = { PRM: '×¤×¨×™××™×•×', OFS: '××•×¤×¡×™×™×˜', CKT: '×§×•×§×˜×œ×™×', BRC: "×‘×¨×× ×¥'", RNT: '×”×©×›×¨×ª ×—×œ×œ' };

        const now = new Date();
        const dd = String(now.getDate()).padStart(2, '0');
        const mm = String(now.getMonth() + 1).padStart(2, '0');
        const yy = String(now.getFullYear()).slice(-2);
        const hh = String(now.getHours()).padStart(2, '0');
        const min = String(now.getMinutes()).padStart(2, '0');

        const W = 680, scale = 2;
        const BG = '#3558A0', GOLD = '#C8A84E', WHITE = '#ffffff', LIGHT = 'rgba(255,255,255,0.7)';

        const lines = [];
        const push = (text, style = {}) => lines.push({ text, ...style });

        push('×”×¦×¢×ª ××—×™×¨ â€“ ×—×•×‘×•×ª ×”×œ×‘×‘×•×ª', { size: 22, weight: 'bold', color: WHITE, y: 60 });
        push(`××¡×¤×¨ ×”×¦×¢×”: ${dd}${mm}${yy}-${hh}${min}`, { size: 13, color: LIGHT, y: 85 });
        push('×¤×¨×˜×™ ×”××™×¨×•×¢', { size: 14, weight: 'bold', color: GOLD, y: 130 });
        push(`×¡×•×’: ${eventNames[eventType]}  |  ××‘×•×’×¨×™×: ${adults}${children > 0 ? `  |  ×™×œ×“×™×: ${children}` : ''}`, { size: 14, color: WHITE, y: 160 });
        push('×¤×™×¨×•×˜ ×¢×œ×•×™×•×ª', { size: 14, weight: 'bold', color: GOLD, y: 200 });

        let yPos = 230;
        calc.income.forEach(item => {
          push(`${item.label}: ${Math.round(item.amount).toLocaleString('he-IL')} â‚ª`, { size: 13, color: WHITE, y: yPos });
          yPos += 28;
        });

        if (calc.childrenDiscount < 0) {
          push(`×”× ×—×” ×œ×™×œ×“×™×: ${Math.round(calc.childrenDiscount).toLocaleString('he-IL')} â‚ª`, { size: 13, color: '#ffb3b3', y: yPos }); yPos += 28;
        }
        if (calc.percentageDiscount < 0) {
          push(`×”× ×—×” ${params.DSC}%: ${Math.round(calc.percentageDiscount).toLocaleString('he-IL')} â‚ª`, { size: 13, color: '#ffb3b3', y: yPos }); yPos += 28;
        }

        yPos += 10;
        push(`×œ×¤× ×™ ××¢"×: ${Math.round(calc.REV).toLocaleString('he-IL')} â‚ª`, { size: 14, color: WHITE, y: yPos }); yPos += 30;
        push(`××¢"× 18%: ${Math.round(calc.vat).toLocaleString('he-IL')} â‚ª`, { size: 14, color: WHITE, y: yPos }); yPos += 30;
        if ((params.TIP || 0) > 0) { push(`×˜×™×¤ ${params.TIP}%: ${Math.round(calc.tip).toLocaleString('he-IL')} â‚ª`, { size: 14, color: WHITE, y: yPos }); yPos += 30; }
        yPos += 10;
        push(`×¡×”"×› ×œ×ª×©×œ×•×: ${Math.round(calc.finalTotal).toLocaleString('he-IL')} â‚ª`, { size: 20, weight: 'bold', color: GOLD, y: yPos }); yPos += 50;
        push('×—×•×‘×•×ª ×”×œ×‘×‘×•×ª  |  054.8977.896', { size: 12, color: LIGHT, y: yPos + 20 });

        const totalH = yPos + 80;
        const canvas = document.createElement('canvas');
        canvas.width = W * scale;
        canvas.height = totalH * scale;
        const ctx = canvas.getContext('2d');
        ctx.scale(scale, scale);
        ctx.fillStyle = BG;
        ctx.fillRect(0, 0, W, totalH);

        lines.forEach(line => {
          ctx.font = `${line.weight || 'normal'} ${line.size || 14}px system-ui, sans-serif`;
          ctx.fillStyle = line.color || WHITE;
          ctx.textAlign = 'center';
          ctx.fillText(line.text, W / 2, line.y);
        });

        canvas.toBlob((blob) => {
          const filename = `×”×¦×¢×ª_××—×™×¨_${dd}${mm}${yy}_${hh}${min}.png`;
          if (mondayItemId) {
            uploadToMonday(blob, filename);
          } else {
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
          }
        }, 'image/png');
      };

      // ========== PDF GENERATION ==========
      const handleGeneratePDF = () => {
        setPdfLoading(true);
        try {
          const baseHtml = generateHTMLQuote(true);
          const htmlWithPrint = baseHtml.replace('</body>', `
<div style="text-align:center;padding:20px;position:fixed;bottom:0;left:0;right:0;background:#2c4d8a;z-index:999;" class="no-print-btn">
  <button onclick="this.parentElement.style.display='none';window.print();" style="background:#C8A84E;color:#1e3a5f;border:none;padding:14px 40px;font-size:16px;font-weight:700;border-radius:8px;cursor:pointer;font-family:'Heebo',sans-serif;">×©××•×¨ ×›-PDF</button>
</div>
<style>@media print{.no-print-btn{display:none!important}}</style>
</body>`);
          const blob = new Blob([htmlWithPrint], { type: 'text/html;charset=utf-8' });
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          const now = new Date();
          const dd = String(now.getDate()).padStart(2, '0');
          const mm = String(now.getMonth() + 1).padStart(2, '0');
          const yy = String(now.getFullYear()).slice(-2);
          a.download = `×”×¦×¢×ª_××—×™×¨_${dd}${mm}${yy}.html`;
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
          URL.revokeObjectURL(url);
        } catch (err) {
          console.error('PDF error:', err);
        } finally {
          setPdfLoading(false);
        }
      };

      const calc = calculatePricing();
      const config = pricingData[eventType];

      const eventTypes = [
        { key: 'PRM', label: '×¤×¨×™××™×•×', icon: 'âœ¨' },
        { key: 'OFS', label: '××•×¤×¡×™×™×˜', icon: 'ğŸ•ï¸' },
        { key: 'CKT', label: '×§×•×§×˜×œ×™×', icon: 'ğŸ¸' },
        { key: 'BRC', label: "×‘×¨×× ×¥'", icon: 'ğŸ¥' },
        { key: 'RNT', label: '×”×©×›×¨×ª ×—×œ×œ', icon: 'ğŸ›ï¸' },
      ];

      const Toggle = ({ checked, onChange, label, included }) => {
        if (included) return (
          <div className="bg-amber-50 px-3 py-2 rounded-lg border-2 border-amber-200 flex items-center justify-between">
            <span className="text-gray-700 font-semibold text-sm">{label}</span>
            <span className="text-xs bg-amber-200 text-amber-800 font-bold px-2 py-0.5 rounded-full">×›×œ×•×œ</span>
          </div>
        );
        return (
          <label className={`flex items-center gap-2 cursor-pointer px-3 py-2 rounded-lg border-2 transition-all ${checked ? 'bg-amber-100 border-amber-400 shadow-sm' : 'bg-amber-50 border-amber-200 hover:border-amber-300'}`}>
            <input type="checkbox" checked={checked} onChange={onChange} className="w-4 h-4 accent-amber-600" />
            <span className="text-gray-700 font-semibold text-sm">{label}</span>
            {checked && <span className="mr-auto text-amber-600 text-xs font-bold">âœ“</span>}
          </label>
        );
      };

      return (
        <div className="min-h-screen bg-gradient-to-br from-amber-50 to-orange-50 p-3" dir="rtl" style={{ fontFamily: 'system-ui, -apple-system, sans-serif' }}>
          <div className="max-w-7xl mx-auto">
            {/* Header */}
            <div className="bg-gradient-to-l from-amber-700 to-orange-600 text-white rounded-xl shadow-lg p-5 mb-5 flex items-center justify-center gap-5">
              <div className="flex-shrink-0">
                <div className="w-16 h-16 bg-amber-50 rounded-full flex items-center justify-center shadow-inner overflow-hidden border-2 border-amber-200">
                  <svg viewBox="0 0 100 120" width="58" height="70" xmlns="http://www.w3.org/2000/svg">
                    <ellipse cx="50" cy="60" rx="46" ry="56" stroke="#3d4fa0" strokeWidth="3" fill="#fdf8f0"/>
                    <path d="M50 82 C50 82 26 65 26 50 C26 41 33 36 41 40 C45.5 42 50 48 50 48 C50 48 54.5 42 59 40 C67 36 74 41 74 50 C74 65 50 82 50 82Z" stroke="#3d4fa0" strokeWidth="2.5" fill="none" strokeLinecap="round" strokeLinejoin="round"/>
                    <path d="M40 52 Q45 46 50 52 Q55 58 60 52" stroke="#3d4fa0" strokeWidth="2" fill="none" strokeLinecap="round"/>
                    <circle cx="8" cy="60" r="2.5" fill="#3d4fa0"/>
                    <circle cx="92" cy="60" r="2.5" fill="#3d4fa0"/>
                    <text x="50" y="28" textAnchor="middle" fontFamily="serif" fontSize="11" fill="#3d4fa0" fontWeight="bold">×—×•×‘×•×ª</text>
                    <text x="50" y="105" textAnchor="middle" fontFamily="serif" fontSize="11" fill="#3d4fa0" fontWeight="bold">×”×œ×‘×‘×•×ª</text>
                  </svg>
                </div>
              </div>
              <div className="text-center">
                <h1 className="text-2xl font-bold">××¢×¨×›×ª ×ª××—×•×¨ ××™×¨×•×¢×™×</h1>
                <p className="mt-0.5 text-amber-100">×—×•×‘×•×ª ×”×œ×‘×‘×•×ª</p>
                {mondayItemId && (
                  <div className="mt-2 inline-flex items-center gap-2 bg-blue-600 text-white text-xs font-bold px-3 py-1 rounded-full shadow">
                    ğŸ“‹ ××—×•×‘×¨ ×œ-Monday #{mondayItemId}
                  </div>
                )}
              </div>
              <div className="flex-shrink-0 w-16"></div>
            </div>

            <div className="grid grid-cols-1 lg:grid-cols-2 gap-5">
              {/* INPUT */}
              <div className="bg-white rounded-xl shadow-lg p-5">
                <h2 className="text-xl font-bold text-amber-800 mb-4">×¤×¨×˜×™ ×”××™×¨×•×¢</h2>

                {/* Event Type Cards */}
                <div className="grid grid-cols-5 gap-2 mb-5">
                  {eventTypes.map(et => (
                    <button key={et.key} onClick={() => setEventType(et.key)}
                      className={`flex flex-col items-center justify-center p-2.5 rounded-xl border-2 transition-all cursor-pointer
                        ${eventType === et.key ? 'bg-amber-100 border-amber-500 shadow-md scale-105' : 'bg-amber-50 border-amber-200 hover:border-amber-400'}`}>
                      <span className="text-2xl mb-1">{et.icon}</span>
                      <span className={`text-xs font-bold ${eventType === et.key ? 'text-amber-800' : 'text-gray-600'}`}>{et.label}</span>
                    </button>
                  ))}
                </div>

                {/* Adults & Children */}
                <div className="grid grid-cols-2 gap-4 mb-4">
                  {config.ADT && (
                    <div>
                      <label className="block text-gray-700 font-semibold mb-1 text-sm">××‘×•×’×¨×™× ({config.ADT.min}-{config.ADT.max})</label>
                      <input type="range" min={config.ADT.min} max={config.ADT.max} value={params.ADT || config.ADT.default}
                        onChange={(e) => setParams({...params, ADT: parseInt(e.target.value)})}
                        className="w-full h-2 bg-amber-200 rounded-lg appearance-none cursor-pointer accent-amber-600" />
                      <div className="text-center mt-1 text-xl font-bold text-amber-700 bg-amber-50 p-1 rounded">{params.ADT || config.ADT.default}</div>
                    </div>
                  )}
                  {config.CHD && (
                    <div>
                      <label className="block text-gray-700 font-semibold mb-1 text-sm">×™×œ×“×™× ({config.CHD.min}-{config.CHD.max})</label>
                      <input type="range" min={config.CHD.min} max={config.CHD.max} value={params.CHD || config.CHD.default}
                        onChange={(e) => setParams({...params, CHD: parseInt(e.target.value)})}
                        className="w-full h-2 bg-amber-200 rounded-lg appearance-none cursor-pointer accent-amber-600" />
                      <div className="text-center mt-1 text-xl font-bold text-amber-700 bg-amber-50 p-1 rounded">{params.CHD || config.CHD.default}</div>
                    </div>
                  )}
                </div>

                {/* Food + Kashrut */}
                <div className="grid grid-cols-2 gap-3 mb-3">
                  {config.FOD && <Toggle label="××•×›×œ" included={config.FOD === '×›×œ×•×œ'} checked={params.FOD === '×›×Ÿ'} onChange={(e) => setParams({...params, FOD: e.target.checked ? '×›×Ÿ' : '×œ×'})} />}
                  {config.KSH && <Toggle label="×”×›×©×¨×ª ×¨×‘" checked={params.KSH === '×›×Ÿ'} onChange={(e) => setParams({...params, KSH: e.target.checked ? '×›×Ÿ' : '×œ×'})} />}
                </div>

                {/* Cork + Ceramics */}
                <div className="grid grid-cols-2 gap-3 mb-3">
                  {config.CRK && <Toggle label="×“××™ ×—×œ×™×¦×”" checked={params.CRK === '×›×Ÿ'} onChange={(e) => setParams({...params, CRK: e.target.checked ? '×›×Ÿ' : '×œ×'})} />}
                  {config.CER && <Toggle label="×¡×“× ×ª ×§×¨××™×§×”" checked={params.CER === '×›×Ÿ'} onChange={(e) => setParams({...params, CER: e.target.checked ? '×›×Ÿ' : '×œ×'})} />}
                </div>

                {/* Flowers + Wine */}
                <div className="grid grid-cols-2 gap-3 mb-3">
                  {config.FLW && <Toggle label="×¤×¨×—×™×" included={config.FLW === '×›×œ×•×œ'} checked={params.FLW === '×›×Ÿ'} onChange={(e) => setParams({...params, FLW: e.target.checked ? '×›×Ÿ' : '×œ×'})} />}
                  {config.WIN && <Toggle label="×™×™×Ÿ" included={config.WIN === '×›×œ×•×œ'} checked={params.WIN === '×›×Ÿ'} onChange={(e) => setParams({...params, WIN: e.target.checked ? '×›×Ÿ' : '×œ×'})} />}
                </div>

                {/* Protein + Premium Wine */}
                <div className="grid grid-cols-2 gap-3 mb-3">
                  {config.PRO && (
                    <div>
                      <label className="block text-gray-700 font-semibold mb-1 text-sm">×× ×•×ª ×—×œ×‘×•×Ÿ</label>
                      <div className="flex gap-3 bg-amber-50 p-2 rounded-lg border-2 border-amber-200">
                        {config.PRO.map(num => (
                          <label key={num} className="flex items-center gap-1 cursor-pointer">
                            <input type="radio" name="protein" value={num} checked={(params.PRO || 0) === num}
                              onChange={() => setParams({...params, PRO: num})} className="accent-amber-600 w-4 h-4" />
                            <span className="text-gray-700 font-semibold text-sm">{num}</span>
                          </label>
                        ))}
                      </div>
                    </div>
                  )}
                  {config.WINP && (
                    <div className="flex items-end"><div className="w-full">
                      <Toggle label="×™×™×Ÿ ×¤×¨×™××™×•×" checked={params.WINP === '×›×Ÿ'} onChange={(e) => setParams({...params, WINP: e.target.checked ? '×›×Ÿ' : '×œ×'})} />
                    </div></div>
                  )}
                </div>

                {/* Kitchen + Waiters */}
                <div className="grid grid-cols-2 gap-3 mb-3">
                  {config.KIT && (
                    <div className="flex items-end"><div className="w-full">
                      <Toggle label="×©×™××•×© ×‘××˜×‘×—" checked={params.KIT === '×›×Ÿ'} onChange={(e) => setParams({...params, KIT: e.target.checked ? '×›×Ÿ' : '×œ×'})} />
                    </div></div>
                  )}
                  {config.WTR && (
                    <div>
                      {config.WTR === 'calc' ? (
                        <div className="bg-amber-50 px-3 py-2 rounded-lg border-2 border-amber-200 flex items-center justify-between">
                          <span className="text-gray-700 font-semibold text-sm">××œ×¦×¨×™×</span>
                          <span className="text-amber-700 font-bold">{calculateWaiters()}</span>
                        </div>
                      ) : (
                        <>
                          <label className="block text-gray-700 font-semibold mb-1 text-sm">××œ×¦×¨×™×</label>
                          <select value={params.WTR || 0} onChange={(e) => setParams({...params, WTR: parseInt(e.target.value)})}
                            className="w-full p-2 border-2 border-amber-300 rounded-lg bg-amber-50 text-sm">
                            {config.WTR.map(num => <option key={num} value={num}>{num}</option>)}
                          </select>
                        </>
                      )}
                    </div>
                  )}
                </div>

                {/* Discount & Tip */}
                <div className="grid grid-cols-2 gap-4 mb-2">
                  {config.DSC && (
                    <div>
                      <label className="block text-gray-700 font-semibold mb-1 text-sm">×”× ×—×” ({config.DSC.min}%-{config.DSC.max}%)</label>
                      <input type="range" min={config.DSC.min} max={config.DSC.max} value={params.DSC || config.DSC.default}
                        onChange={(e) => setParams({...params, DSC: parseInt(e.target.value)})}
                        className="w-full h-2 bg-amber-200 rounded-lg appearance-none cursor-pointer accent-amber-600" />
                      <div className="text-center mt-1 text-lg font-bold text-amber-700 bg-amber-50 p-1 rounded">{params.DSC || config.DSC.default}%</div>
                    </div>
                  )}
                  {config.TIP && (
                    <div>
                      <label className="block text-gray-700 font-semibold mb-1 text-sm">×˜×™×¤ ({config.TIP.min}%-{config.TIP.max}%)</label>
                      <input type="range" min={config.TIP.min} max={config.TIP.max} value={params.TIP !== undefined ? params.TIP : config.TIP.default}
                        onChange={(e) => setParams({...params, TIP: parseInt(e.target.value)})}
                        className="w-full h-2 bg-amber-200 rounded-lg appearance-none cursor-pointer accent-amber-600" />
                      <div className="text-center mt-1 text-lg font-bold text-amber-700 bg-amber-50 p-1 rounded">{params.TIP !== undefined ? params.TIP : config.TIP.default}%</div>
                    </div>
                  )}
                </div>
              </div>

              {/* PRICING SUMMARY */}
              <div className="bg-white rounded-xl shadow-lg p-5">
                <h2 className="text-xl font-bold text-amber-800 mb-4">×¡×™×›×•× ×ª××—×•×¨</h2>

                <div className="grid grid-cols-2 gap-4 mb-5">
                  <div className="bg-green-50 rounded-lg p-3 border-2 border-green-200">
                    <h3 className="font-bold text-green-800 mb-3 text-base">×”×›× ×¡×•×ª</h3>
                    <div className="space-y-1.5">
                      {calc.income.map((item, idx) => (
                        <div key={idx} className="flex justify-between text-xs gap-1">
                          <span className="text-gray-700">{item.label}</span>
                          <span className="text-green-700 font-semibold whitespace-nowrap">{fmt(item.amount)}</span>
                        </div>
                      ))}
                      <div className="border-t-2 border-green-300 pt-2 mt-2">
                        <div className="flex justify-between font-bold text-sm">
                          <span>×¡×”"×›</span>
                          <span className="text-green-700">{fmt(calc.income.reduce((s, i) => s + i.amount, 0))} ×©"×—</span>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div className="bg-red-50 rounded-lg p-3 border-2 border-red-200">
                    <h3 className="font-bold text-red-800 mb-3 text-base">×”×•×¦××•×ª</h3>
                    <div className="space-y-1.5">
                      {calc.outcome.map((item, idx) => (
                        <div key={idx} className="flex justify-between text-xs gap-1">
                          <span className="text-gray-700">{item.label}</span>
                          <span className="text-red-700 font-semibold whitespace-nowrap" dir="ltr">-{fmt(Math.abs(item.amount))}</span>
                        </div>
                      ))}
                      <div className="border-t-2 border-red-300 pt-2 mt-2">
                        <div className="flex justify-between font-bold text-sm">
                          <span>×¡×”"×›</span>
                          <span className="text-red-700" dir="ltr">-{fmt(Math.abs(calc.COG))} ×©"×—</span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                {/* Final Summary */}
                <div className="bg-amber-50 rounded-xl p-5 border-2 border-amber-300 space-y-2.5">
                  {calc.childrenDiscount < 0 && (
                    <div className="flex justify-between">
                      <span className="font-semibold">×”× ×—×” ×œ×™×œ×“×™× ({params.CHD})</span>
                      <span className="text-red-600 font-bold" dir="ltr">-{fmt(Math.abs(calc.childrenDiscount))} ×©"×—</span>
                    </div>
                  )}
                  {calc.percentageDiscount < 0 && (
                    <div className="flex justify-between">
                      <span className="font-semibold">×”× ×—×” ({params.DSC}%)</span>
                      <span className="text-red-600 font-bold" dir="ltr">-{fmt(Math.abs(calc.percentageDiscount))} ×©"×—</span>
                    </div>
                  )}
                  <div className="flex justify-between border-t-2 border-amber-400 pt-2">
                    <span className="font-semibold">×¡×”"×› ×œ×¤× ×™ ××¢"×</span>
                    <span className="text-green-600 font-bold">{fmt(calc.REV)} ×©"×—</span>
                  </div>
                  <div className="flex justify-between">
                    <span className="font-semibold">××¢"× (18%)</span>
                    <span className="text-green-600 font-bold">{fmt(calc.vat)} ×©"×—</span>
                  </div>
                  <div className="flex justify-between">
                    <span className="font-semibold">×˜×™×¤ ({params.TIP}%)</span>
                    <span className="text-green-600 font-bold">{fmt(calc.tip)} ×©"×—</span>
                  </div>
                  <div className="flex justify-between text-xl border-t-4 border-amber-500 pt-3 mt-2">
                    <span className="font-bold">×¡×”"×› ×œ×ª×©×œ×•×</span>
                    <span className="text-green-600 font-bold">{fmt(calc.finalTotal)} ×©"×—</span>
                  </div>
                </div>

                {/* WhatsApp */}
                <button onClick={handleCopyWhatsApp}
                  className={`w-full mt-5 font-bold py-3.5 px-6 rounded-xl shadow-lg transition-all text-lg ${copied ? 'bg-green-600 text-white scale-95' : 'bg-green-500 hover:bg-green-600 text-white hover:shadow-xl'}`}>
                  {copied ? 'âœ… ×”×•×¢×ª×§! ×”×“×‘×§ ×‘×•×•×˜×¡××¤' : 'ğŸ“± ×”×¢×ª×§ ×”×¦×¢×ª ××—×™×¨ ×œ×•×•×˜×¡××¤'}
                </button>

                {/* Save / Send to Monday */}
                <button onClick={handleSaveFile}
                  className={`w-full mt-2 font-bold py-3 px-6 rounded-xl shadow-lg transition-all text-base ${
                    mondayStatus === 'uploading' ? 'bg-blue-400 text-white cursor-wait opacity-70' :
                    mondayStatus === 'success' ? 'bg-green-600 text-white scale-95' :
                    mondayStatus === 'error' ? 'bg-red-500 text-white' :
                    saved ? 'bg-amber-600 text-white scale-95' :
                    'bg-amber-500 hover:bg-amber-600 text-white hover:shadow-xl'
                  }`}>
                  {mondayStatus === 'uploading' ? 'â³ ×©×•×œ×— ×œ-Monday...' :
                   mondayStatus === 'success' ? 'âœ… × ×©×œ×— ×œ-Monday!' :
                   mondayStatus === 'error' ? 'âŒ ×©×’×™××” ×‘×©×œ×™×—×” â€“ × ×¡×” ×©×•×‘' :
                   saved ? 'âœ… ×”×§×•×‘×¥ × ×©××¨!' :
                   mondayItemId ? 'ğŸ“¤ ×©×œ×— ×”×¦×¢×ª ××—×™×¨ ×œ-Monday' : 'ğŸ–¼ï¸ ×©××•×¨ ×”×¦×¢×ª ××—×™×¨ ×›×ª××•× ×”'}
                </button>

                {/* PDF */}
                <button onClick={handleGeneratePDF} disabled={pdfLoading}
                  className={`w-full mt-2 font-bold py-3 px-6 rounded-xl shadow-lg transition-all text-base ${pdfLoading ? 'bg-blue-400 text-white cursor-wait opacity-70' : 'bg-blue-600 hover:bg-blue-700 text-white hover:shadow-xl'}`}>
                  {pdfLoading ? 'â³ ××›×™×Ÿ ×§×•×‘×¥...' : 'ğŸ“„ ×¦×•×¨ ×”×¦×¢×ª ××—×™×¨ ×‘-PDF'}
                </button>

                <button onClick={() => setShowPreview(!showPreview)} className="w-full mt-2 text-sm text-amber-700 hover:text-amber-900 underline">
                  {showPreview ? '×”×¡×ª×¨ ×ª×¦×•×’×” ××§×“×™××”' : '×”×¦×’ ×ª×¦×•×’×” ××§×“×™××” ×©×œ ×”×”×•×“×¢×”'}
                </button>

                {showPreview && (
                  <div className="mt-3 bg-green-50 border-2 border-green-200 rounded-xl p-4">
                    <pre className="whitespace-pre-wrap text-gray-800 text-xs leading-relaxed" style={{ fontFamily: 'system-ui, sans-serif' }}>
                      {generateWhatsAppMessage()}
                    </pre>
                  </div>
                )}

                <div className="mt-3 flex justify-between items-center text-sm text-gray-500 px-1">
                  <span>×¨×•×•×— ×’×•×œ××™</span>
                  <span className={`font-semibold ${calc.GDP >= 0 ? 'text-green-600' : 'text-red-600'}`} dir="ltr">
                    {calc.GDP < 0 ? '-' : ''}{fmt(Math.abs(calc.GDP))} ×©"×—
                    <span className="mr-1 opacity-75">({calc.REV > 0 ? Math.round((calc.GDP / calc.REV) * 100) : 0}%)</span>
                  </span>
                </div>
              </div>
            </div>
          </div>
        </div>
      );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<HVLPricingApp />);
  </script>
</body>
</html>
