<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>×—×•×‘×•×ª ×”×œ×‘×‘×•×ª - ××—×©×‘×•×Ÿ ×ª××—×•×¨</title>
<link href="https://fonts.googleapis.com/css2?family=Assistant:wght@300;400;600;700;800&family=Heebo:wght@300;400;500;700;800&family=Playfair+Display:wght@400;600;700&display=swap" rel="stylesheet"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.9/babel.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js"></script>
<style>
*{box-sizing:border-box;margin:0;padding:0}
body{font-family:'Assistant','Heebo',sans-serif;direction:rtl}
input[type=range]{cursor:pointer}
select{cursor:pointer}
</style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const {useState,useEffect,useMemo,useRef,useCallback}=React;

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• DATA â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const DEFAULT_CSV_DATA={
  eventTypes:["PRM","OFS","CKT","BRC","RNT"],
  eventLabels:{PRM:"PRM - ×¤×¨×™××™×•×",OFS:"OFS - ××•×¤×¡×™×™×˜",CKT:"CKT - ×§×•×§×˜×œ×™×",BRC:"BRC - ×‘×¨×× ×¥'",RNT:"RNT - ×”×©×›×¨×ª ×—×œ×œ"},
  inputs:{
    ADT:{label:"×›××•×ª ××‘×•×’×¨×™×",PRM:"15-80",OFS:"10-70",CKT:"15-80",BRC:"15-80",RNT:"15-80"},
    CHD:{label:"×›××•×ª ×™×œ×“×™×",PRM:"0-20",OFS:"×œ× ×¨×œ×•×•× ×˜×™",CKT:"0-20",BRC:"0-20",RNT:"0-20"},
    FOD:{label:"×”×× × ×“×¨×© ××•×›×œ?",PRM:"×›×œ×•×œ",OFS:"×œ× / ×›×Ÿ",CKT:"×›×œ×•×œ",BRC:"×›×œ×•×œ",RNT:"×œ× ×¨×œ×•×•× ×˜×™"},
    KSH:{label:"×”×× × ×“×¨×© ×”×›×©×¨×ª ×¨×‘",PRM:"×œ× / ×›×Ÿ",OFS:"×œ× / ×›×Ÿ",CKT:"×œ× / ×›×Ÿ",BRC:"×œ× / ×›×Ÿ",RNT:"×œ× ×¨×œ×•×•× ×˜×™"},
    WTR:{label:"×”×× × ×“×¨×© ××œ×¦×¨?",PRM:"ROUNDUP (ADT+CHD) / 20",OFS:"0 / 1 / 2",CKT:"ROUNDUP (ADT+CHD) / 20",BRC:"ROUNDUP (ADT+CHD) / 20",RNT:"0 / 1 / 2"},
    PRO:{label:"×ª×•×¡×¤×ª ×× ×•×ª ×—×œ×‘×•×Ÿ (×œ××“×)",PRM:"0 / 1 / 2",OFS:"0 / 1 / 2",CKT:"0 / 1 / 2",BRC:"0 / 1 / 2",RNT:"0 / 1 / 2"},
    CRK:{label:"×“××™ ×—×œ×™×¦×”",PRM:"×œ× / ×›×Ÿ",OFS:"×œ× / ×›×Ÿ",CKT:"×œ× / ×›×Ÿ",BRC:"×œ× / ×›×Ÿ",RNT:"×œ× ×¨×œ×•×•× ×˜×™"},
    CER:{label:"×¡×“× ×ª ×§×¨××™×§×”",PRM:"×œ× / ×›×Ÿ",OFS:"×œ× / ×›×Ÿ",CKT:"×œ× / ×›×Ÿ",BRC:"×œ× / ×›×Ÿ",RNT:"×œ× ×¨×œ×•×•× ×˜×™"},
    FLW:{label:"×”×× × ×“×¨×© ×¤×¨×—×™×",PRM:"×›×œ×•×œ",OFS:"×œ× / ×›×Ÿ",CKT:"×›×œ×•×œ",BRC:"×›×œ×•×œ",RNT:"×œ× / ×›×Ÿ"},
    WIN:{label:"×”×× × ×“×¨×© ×™×™×Ÿ",PRM:"×›×œ×•×œ",OFS:"×œ× / ×›×Ÿ",CKT:"×›×œ×•×œ",BRC:"×›×œ×•×œ",RNT:"×œ× / ×›×Ÿ"},
    WINP:{label:"×”×× × ×“×¨×© ×ª×•×¡×¤×ª ×™×™×Ÿ ×¤×¨×™××™×•×",PRM:"×œ× / ×›×Ÿ",OFS:"×œ× ×¨×œ×•×•× ×˜×™",CKT:"×œ× / ×›×Ÿ",BRC:"×œ× / ×›×Ÿ",RNT:"×œ× ×¨×œ×•×•× ×˜×™"},
    KIT:{label:"×”×× × ×“×¨×© ×©×™××•×© ×‘××˜×‘×—",PRM:"×œ× ×¨×œ×•×•× ×˜×™",OFS:"×œ× / ×›×Ÿ",CKT:"×œ× ×¨×œ×•×•× ×˜×™",BRC:"×œ× ×¨×œ×•×•× ×˜×™",RNT:"×œ× / ×›×Ÿ"},
    DSC:{label:"××—×•×–×™ ×”× ×—×”",PRM:"0-15",OFS:"0-15",CKT:"0-15",BRC:"0-15",RNT:"0-15"},
    TIP:{label:"××—×•×–×™× ×œ×˜×™×¤",PRM:"15-0",OFS:"15-0",CKT:"15-0",BRC:"15-0",RNT:"15-0"},
  },
  pricing:{
    IBASE:{label:"×—×‘×™×œ×ª ×‘×¡×™×¡ (×¢×“ 15 ×× ×©×™×)",PRM:9900,OFS:5500,CKT:7050,BRC:8250,RNT:5500},
    IMORE:{label:"×ª×•×¡×¤×ª ××¢×‘×¨ ×œ-15 ×× ×©×™× (×œ××“×)",PRM:550,OFS:500,CKT:470,BRC:500,RNT:"formula"},
    ICRK:{label:"×“××™ ×—×œ×™×¦×”",PRM:1000,OFS:1000,CKT:1000,BRC:1000,RNT:null},
    IPRO:{label:"×ª×•×¡×¤×ª ×× ×ª ×—×œ×‘×•×Ÿ (×œ××“×)",PRM:75,OFS:75,CKT:75,BRC:75,RNT:null},
    ICER:{label:"×¡×“× ×ª ×§×¨××™×§×” (×œ××“×)",PRM:350,OFS:350,CKT:350,BRC:350,RNT:null},
    IWINP:{label:"×ª×•×¡×¤×ª ×™×™×Ÿ ×¤×¨×™××™×•× (×œ××“×)",PRM:60,OFS:60,CKT:60,BRC:60,RNT:null},
    IKIT:{label:"×©×™××•×© ×‘××˜×‘×—",PRM:null,OFS:150,CKT:null,BRC:null,RNT:1000},
    IFLW:{label:"×¡×™×“×•×¨ ×¤×¨×—×™×",PRM:"×›×œ×•×œ",OFS:1200,CKT:"×›×œ×•×œ",BRC:1200,RNT:1200},
    IWIN:{label:"×™×™×Ÿ (×œ××“×)",PRM:"×›×œ×•×œ",OFS:70,CKT:70,BRC:70,RNT:70},
    IKSH:{label:"×”×›×©×¨×ª ×¨×‘",PRM:1500,OFS:1500,CKT:1500,BRC:1500,RNT:1500},
    OPRO1:{label:"×¢×œ×•×ª ×× ×ª ×—×œ×‘×•×Ÿ ×—×•××¨ ×’×œ×",PRM:"formula",OFS:"formula",CKT:"formula",BRC:"formula",RNT:null},
    OPRO2:{label:"×¢×œ×•×ª ×× ×ª ×—×œ×‘×•×Ÿ (×©×£)",PRM:20,OFS:20,CKT:20,BRC:20,RNT:null},
    OCER:{label:"×¢×œ×•×ª ×¡×“× ×ª ×§×¨××™×§×” (×œ××“×)",PRM:175,OFS:175,CKT:175,BRC:175,RNT:null},
    OWINP:{label:"×¢×œ×•×ª ×ª×•×¡×¤×ª ×™×™×Ÿ ×¤×¨×™××™×•×",PRM:10,OFS:10,CKT:10,BRC:10,RNT:null},
    OKIT:{label:"×¢×œ×•×ª ×©×™××•×© ×‘××˜×‘×—",PRM:null,OFS:0,CKT:null,BRC:null,RNT:0},
    OFLW:{label:"×¢×œ×•×ª ×¤×¨×—×™×",PRM:800,OFS:800,CKT:800,BRC:800,RNT:800},
    OWIN:{label:"×¢×œ×•×ª ×™×™×Ÿ",PRM:20,OFS:20,CKT:20,BRC:20,RNT:20},
    OKSH:{label:"×¢×œ×•×ª ×”×›×©×¨×ª ×¨×‘",PRM:1000,OFS:1000,CKT:1000,BRC:1000,RNT:1000},
    OCHEFB:{label:"×©×£ ×‘×¡×™×¡",PRM:2100,OFS:1200,CKT:1400,BRC:1400,RNT:null},
    OCHEF1:{label:"×©×£ ×ª×•×¡×¤×ª (×××“× 36)",PRM:40,OFS:null,CKT:40,BRC:40,RNT:null},
    OCHEF2:{label:"×©×£ ×ª×•×¡×¤×ª (×××“× 11)",PRM:null,OFS:30,CKT:null,BRC:null,RNT:null},
    OCOOK:{label:"×¢×œ×•×ª ×˜×‘×— × ×•×¡×£",PRM:"cook20",OFS:"cook28",CKT:"cook28",BRC:"cook28",RNT:null},
    OFOOD:{label:"×¢×œ×•×ª ×¤×•×“×§×•×¡×˜ (×œ××“×)",PRM:70,OFS:70,CKT:55,BRC:70,RNT:null},
    OCLEAN:{label:"× ×§×™×•×Ÿ",PRM:500,OFS:500,CKT:500,BRC:500,RNT:500},
    OEVM:{label:"×× ×”×œ ××™×¨×•×¢",PRM:700,OFS:700,CKT:700,BRC:700,RNT:700},
    OWTR:{label:"××œ×¦×¨ (×œ×™×—×™×“×”)",PRM:400,OFS:400,CKT:400,BRC:400,RNT:400},
    OOVH:{label:"×ª×§×•×¨×” ×§×‘×•×¢×”",PRM:750,OFS:750,CKT:750,BRC:750,RNT:null},
    OSLB:{label:"×‘×•× ×•×¡ ×× ×”×œ ××›×™×¨×•×ª (3%)",percent:0.03},
  }
};
const VAT_RATE=0.18;
const C={cream:"#FBEDDF",tan:"#F3CFBD",terracotta:"#DC8C64",brick:"#B74F3E",rust:"#C64532",sand:"#D7C6C0",sage:"#989777",blue:"#1043BF",darkBrick:"#8B3020",lightCream:"#FFF8F2",white:"#FFFFFF"};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• CSV PARSER â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function parseCSV(text){const lines=text.split(/\r?\n/).map(l=>{const r=[];let cur='',inQ=false;for(let i=0;i<l.length;i++){if(l[i]==='"')inQ=!inQ;else if(l[i]===','&&!inQ){r.push(cur.trim());cur=''}else cur+=l[i]}r.push(cur.trim());return r});return lines}
function loadCSVData(text){const lines=parseCSV(text);const data=JSON.parse(JSON.stringify(DEFAULT_CSV_DATA));const colMap={3:"PRM",4:"OFS",5:"CKT",6:"BRC",7:"RNT"};for(let i=2;i<lines.length;i++){const row=lines[i];if(!row||row.length<3)continue;const code=row[0];if(data.inputs[code])for(const[col,et]of Object.entries(colMap))if(row[col]!==undefined&&row[col]!=='')data.inputs[code][et]=row[col];if(data.pricing[code])for(const[col,et]of Object.entries(colMap))if(row[col]!==undefined&&row[col]!==''){const val=row[col];if(val==="×œ× ×¨×œ×•×•× ×˜×™")data.pricing[code][et]=null;else if(val==="×›×œ×•×œ")data.pricing[code][et]="×›×œ×•×œ";else if(!isNaN(Number(val)))data.pricing[code][et]=Number(val);else data.pricing[code][et]=val}if(!code&&row[2]){const item=row[2];if(item.includes("×˜×‘×— × ×•×¡×£"))for(const[col,et]of Object.entries(colMap)){if(row[col]&&row[col]!=="×œ× ×¨×œ×•×•× ×˜×™"){if(row[col].includes("20"))data.pricing.OCOOK[et]="cook20";else if(row[col].includes("28"))data.pricing.OCOOK[et]="cook28"}else if(row[col]==="×œ× ×¨×œ×•×•× ×˜×™")data.pricing.OCOOK[et]=null}if(item.includes("×¤×•×“×§×•×¡×˜"))for(const[col,et]of Object.entries(colMap)){if(row[col]&&row[col]!=="×œ× ×¨×œ×•×•× ×˜×™"&&!isNaN(Number(row[col])))data.pricing.OFOOD[et]=Number(row[col]);else if(row[col]==="×œ× ×¨×œ×•×•× ×˜×™")data.pricing.OFOOD[et]=null}if(item.includes("× ×§×™×•×Ÿ"))for(const[col,et]of Object.entries(colMap))if(row[col]&&!isNaN(Number(row[col])))data.pricing.OCLEAN[et]=Number(row[col])}}return data}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• SUB-COMPONENTS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function CheckboxField({label,checked,onChange,disabled}){return React.createElement('label',{style:{display:"flex",alignItems:"center",gap:10,cursor:disabled?"default":"pointer",direction:"rtl",fontFamily:"'Assistant',sans-serif",fontSize:14}},React.createElement('div',{style:{width:22,height:22,borderRadius:4,border:`2px solid ${C.brick}`,backgroundColor:C.white,display:"flex",alignItems:"center",justifyContent:"center",opacity:disabled?.6:1}},checked&&React.createElement('svg',{width:14,height:14,viewBox:"0 0 14 14",fill:"none"},React.createElement('path',{d:"M2 7L5.5 10.5L12 3.5",stroke:C.brick,strokeWidth:2.5,strokeLinecap:"round",strokeLinejoin:"round"}))),React.createElement('input',{type:"checkbox",checked,onChange,disabled,style:{display:"none"}}),React.createElement('span',{style:{color:C.darkBrick}},label))}

function SliderField({label,min,max,value,onChange}){const aMin=Math.min(min,max),aMax=Math.max(min,max),rev=min>max;return React.createElement('div',{style:{direction:"rtl",fontFamily:"'Assistant',sans-serif",marginBottom:4}},React.createElement('div',{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:4}},React.createElement('span',{style:{fontSize:14,color:C.darkBrick,fontWeight:600}},label),React.createElement('span',{style:{fontSize:16,fontWeight:700,color:C.brick,backgroundColor:C.white,padding:"2px 12px",borderRadius:6,minWidth:40,textAlign:"center",border:`1px solid ${C.tan}`}},value+'%')),React.createElement('input',{type:"range",min:aMin,max:aMax,value,onChange:e=>onChange(Number(e.target.value)),style:{width:"100%",accentColor:C.brick,direction:rev?"rtl":"ltr"}}),React.createElement('div',{style:{display:"flex",justifyContent:"space-between",fontSize:11,color:C.sage}},React.createElement('span',null,aMin+'%'),React.createElement('span',null,aMax+'%')))}

function NumberSlider({label,min,max,value,onChange,note}){return React.createElement('div',{style:{direction:"rtl",fontFamily:"'Assistant',sans-serif",marginBottom:4}},React.createElement('div',{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:4}},React.createElement('span',{style:{fontSize:14,color:C.darkBrick,fontWeight:600}},label),React.createElement('span',{style:{fontSize:16,fontWeight:700,color:C.brick,backgroundColor:C.white,padding:"2px 12px",borderRadius:6,minWidth:40,textAlign:"center",border:`1px solid ${C.tan}`}},value)),React.createElement('input',{type:"range",min,max,value,onChange:e=>onChange(Number(e.target.value)),style:{width:"100%",accentColor:C.brick}}),React.createElement('div',{style:{display:"flex",justifyContent:"space-between",fontSize:11,color:C.sage}},React.createElement('span',null,min),React.createElement('span',null,max)),note&&React.createElement('div',{style:{fontSize:11,color:C.sage,marginTop:-2}},note))}

function SelectField({label,options,value,onChange,disabled}){return React.createElement('div',{style:{direction:"rtl",fontFamily:"'Assistant',sans-serif",marginBottom:4}},React.createElement('label',{style:{fontSize:14,color:C.darkBrick,fontWeight:600,display:"block",marginBottom:4}},label),disabled?React.createElement('div',{style:{padding:"6px 12px",borderRadius:6,backgroundColor:C.white,border:`1px solid ${C.tan}`,fontSize:14,color:C.darkBrick}},options[0]?.label||value):React.createElement('select',{value,onChange:e=>onChange(e.target.value),style:{width:"100%",padding:"6px 12px",borderRadius:6,border:`1px solid ${C.tan}`,backgroundColor:C.white,fontSize:14,color:C.darkBrick,fontFamily:"'Assistant',sans-serif",cursor:"pointer"}},options.map(o=>React.createElement('option',{key:o.value,value:o.value},o.label))))}

function IncludedField({label}){return React.createElement('div',{style:{direction:"rtl",fontFamily:"'Assistant',sans-serif",marginBottom:4,display:"flex",justifyContent:"space-between",alignItems:"center"}},React.createElement('span',{style:{fontSize:14,color:C.darkBrick,fontWeight:600}},label),React.createElement('span',{style:{fontSize:13,color:C.sage,fontWeight:600,backgroundColor:C.white,padding:"2px 12px",borderRadius:6,border:`1px solid ${C.tan}`}},"×›×œ×•×œ âœ“"))}

function ComputedField({label,value}){return React.createElement('div',{style:{direction:"rtl",fontFamily:"'Assistant',sans-serif",marginBottom:4,display:"flex",justifyContent:"space-between",alignItems:"center"}},React.createElement('span',{style:{fontSize:14,color:C.darkBrick,fontWeight:600}},label),React.createElement('span',{style:{fontSize:15,fontWeight:700,color:C.brick,backgroundColor:C.white,padding:"2px 12px",borderRadius:6,minWidth:30,textAlign:"center",border:`1px solid ${C.tan}`}},value))}

function formatNIS(num){const r=Math.round(num),neg=r<0,abs=Math.abs(r).toLocaleString("he-IL");return neg?`- ${abs} â‚ª`:`${abs} â‚ª`}

function PricingLine({label,amount,isExpense,detail,bold}){const r=Math.round(amount);const color=r<0?"#D32F2F":r>0?(isExpense?"#D32F2F":"#2E7D32"):C.darkBrick;return React.createElement('div',{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"5px 0",borderBottom:`1px solid ${C.cream}`,direction:"rtl",fontFamily:"'Assistant',sans-serif"}},React.createElement('div',null,React.createElement('span',{style:{fontSize:bold?15:13,fontWeight:bold?700:400,color:C.darkBrick}},label),detail&&React.createElement('span',{style:{fontSize:11,color:C.sage,marginRight:6}},detail)),React.createElement('span',{style:{fontSize:bold?16:14,fontWeight:bold?700:500,color,direction:"ltr",whiteSpace:"nowrap"}},formatNIS(r)))}

function SummaryLine({label,amount,isTotal,isExpense}){const r=Math.round(amount);const color=r<0?"#D32F2F":isExpense?"#D32F2F":"#2E7D32";return React.createElement('div',{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:isTotal?"10px 0":"6px 0",borderBottom:isTotal?"none":`1px solid ${C.cream}`,borderTop:isTotal?`2px solid ${C.brick}`:"none",direction:"rtl",fontFamily:"'Assistant',sans-serif"}},React.createElement('span',{style:{fontSize:isTotal?17:14,fontWeight:isTotal?800:600,color:C.darkBrick}},label),React.createElement('span',{style:{fontSize:isTotal?18:15,fontWeight:isTotal?800:600,color,direction:"ltr",whiteSpace:"nowrap"}},formatNIS(r)))}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• MAIN APP â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function App(){
  const[csvData,setCsvData]=useState(()=>{try{const s=localStorage.getItem("hlb_csv_data");return s?JSON.parse(s):DEFAULT_CSV_DATA}catch(e){return DEFAULT_CSV_DATA}});
  const[eventType,setEventType]=useState("PRM");
  const[adults,setAdults]=useState(15);
  const[children,setChildren]=useState(0);
  const[food,setFood]=useState(false);
  const[kosher,setKosher]=useState(false);
  const[protein,setProtein]=useState(0);
  const[cork,setCork]=useState(false);
  const[ceramics,setCeramics]=useState(false);
  const[flowers,setFlowers]=useState(false);
  const[wine,setWine]=useState(false);
  const[winePremium,setWinePremium]=useState(false);
  const[kitchen,setKitchen]=useState(false);
  const[discount,setDiscount]=useState(0);
  const[tip,setTip]=useState(15);
  const[copyMsg,setCopyMsg]=useState("");
  const[pdfTemplate,setPdfTemplate]=useState(null);
  const[pdfGenerating,setPdfGenerating]=useState(false);
  const[manualWaiters,setManualWaiters]=useState(0);
  const fileInputRef=useRef(null);
  const pdfInputRef=useRef(null);

  // Load PDF template from localStorage on mount
  useEffect(()=>{try{const b64=localStorage.getItem("hlb_pdf_template");if(b64){const bin=atob(b64);const bytes=new Uint8Array(bin.length);for(let i=0;i<bin.length;i++)bytes[i]=bin.charCodeAt(i);setPdfTemplate(bytes.buffer)}}catch(e){}},[]);

  const et=eventType,inp=csvData.inputs,pr=csvData.pricing;

  useEffect(()=>{const r=parseRange(inp.ADT[et]);setAdults(r?r[0]:15);setChildren(0);setFood(false);setKosher(false);setProtein(0);setCork(false);setCeramics(false);setFlowers(false);setWine(false);setWinePremium(false);setKitchen(false);setDiscount(0);setTip(15);setManualWaiters(0)},[eventType]);

  function parseRange(v){if(!v||v==="×œ× ×¨×œ×•×•× ×˜×™"||v==="×›×œ×•×œ")return null;const m=v.match(/(\d+)\s*-\s*(\d+)/);return m?[Number(m[1]),Number(m[2])]:null}
  function isNotRelevant(code){return inp[code]?.[et]==="×œ× ×¨×œ×•×•× ×˜×™"}
  function isIncluded(code){return inp[code]?.[et]==="×›×œ×•×œ"}
  function isComputed(code){return inp[code]?.[et]?.startsWith?.("ROUNDUP")}

  const totalPeople=adults+children;
  const adultRange=parseRange(inp.ADT[et]);
  const childRange=!isNotRelevant("CHD")?parseRange(inp.CHD[et]):null;
  const computedWaiters=isComputed("WTR")?Math.ceil(totalPeople/20):0;

  // â•â•â• INCOME â•â•â•
  const incomeLines=useMemo(()=>{const L=[];
    L.push({code:"IBASE",label:"×—×‘×™×œ×ª ×‘×¡×™×¡ (×¢×“ 15 ×× ×©×™×)",amount:pr.IBASE[et]||0});
    if(totalPeople>15&&et!=="RNT"){const ex=totalPeople-15,pp=pr.IMORE[et];if(typeof pp==="number")L.push({code:"IMORE",label:`×ª×•×¡×¤×ª ${ex} ×× ×©×™× × ×•×¡×¤×™×`,amount:ex*pp,detail:`(${ex} Ã— ${pp} â‚ª)`})}
    else if(totalPeople>15&&et==="RNT"){const ex=Math.ceil(Math.max(0,totalPeople-15)/10)*1000;if(ex>0)L.push({code:"IMORE",label:"×ª×•×¡×¤×ª ××¢×‘×¨ ×œ-15 ×× ×©×™×",amount:ex})}
    if(!isNotRelevant("CRK")&&cork&&pr.ICRK[et])L.push({code:"ICRK",label:"×“××™ ×—×œ×™×¦×”",amount:pr.ICRK[et]});
    if(!isNotRelevant("PRO")&&protein>0&&pr.IPRO[et]){const a=protein*totalPeople*pr.IPRO[et];L.push({code:"IPRO",label:"×ª×•×¡×¤×ª ×× ×•×ª ×—×œ×‘×•×Ÿ",amount:a,detail:`(${totalPeople} Ã— ${protein} Ã— ${pr.IPRO[et]} â‚ª)`})}
    if(!isNotRelevant("CER")&&ceramics&&pr.ICER[et]){const a=totalPeople*pr.ICER[et];L.push({code:"ICER",label:"×¡×“× ×ª ×§×¨××™×§×”",amount:a,detail:`(${totalPeople} Ã— ${pr.ICER[et]} â‚ª)`})}
    if(!isNotRelevant("WINP")&&winePremium&&pr.IWINP[et]){const a=adults*pr.IWINP[et];L.push({code:"IWINP",label:"×ª×•×¡×¤×ª ×™×™×Ÿ ×¤×¨×™××™×•×",amount:a,detail:`(${adults} ××‘×•×’×¨×™× Ã— ${pr.IWINP[et]} â‚ª)`})}
    if(!isNotRelevant("KIT")&&kitchen&&pr.IKIT[et])L.push({code:"IKIT",label:"×©×™××•×© ×‘××˜×‘×—",amount:pr.IKIT[et]});
    if(!isNotRelevant("FLW")&&!isIncluded("FLW")&&flowers&&pr.IFLW[et]&&pr.IFLW[et]!=="×›×œ×•×œ")L.push({code:"IFLW",label:"×¡×™×“×•×¨ ×¤×¨×—×™×",amount:pr.IFLW[et]});
    if(!isNotRelevant("WIN")&&!isIncluded("WIN")&&wine&&pr.IWIN[et]&&pr.IWIN[et]!=="×›×œ×•×œ"){const a=adults*pr.IWIN[et];L.push({code:"IWIN",label:"×™×™×Ÿ",amount:a,detail:`(${adults} ××‘×•×’×¨×™× Ã— ${pr.IWIN[et]} â‚ª)`})}
    if(!isNotRelevant("KSH")&&kosher&&pr.IKSH[et])L.push({code:"IKSH",label:"×”×›×©×¨×ª ×¨×‘",amount:pr.IKSH[et]});
    return L},[et,adults,children,cork,protein,ceramics,winePremium,kitchen,flowers,wine,kosher,food,totalPeople,csvData]);

  // â•â•â• EXPENSES â•â•â•
  const expenseLines=useMemo(()=>{const L=[];const isRNT=et==="RNT";
    if(!isRNT&&pr.OCHEFB[et]!=null)L.push({code:"OCHEFB",label:"×©×£ ×‘×¡×™×¡",amount:pr.OCHEFB[et]});
    if(!isRNT&&pr.OCHEF1[et]&&totalPeople>35){const ex=totalPeople-35;L.push({code:"OCHEF1",label:`×©×£ ×ª×•×¡×¤×ª (${ex} ××¢×œ 35)`,amount:ex*pr.OCHEF1[et]})}
    if(!isRNT&&pr.OCHEF2[et]&&totalPeople>10){const ex=totalPeople-10;L.push({code:"OCHEF2",label:`×©×£ ×ª×•×¡×¤×ª (${ex} ××¢×œ 10)`,amount:ex*pr.OCHEF2[et]})}
    if(!isRNT&&pr.OCOOK[et]){let c=0;if(pr.OCOOK[et]==="cook20")c=Math.floor(totalPeople/20)*500;else if(pr.OCOOK[et]==="cook28")c=Math.floor(totalPeople/28)*500;if(c>0)L.push({code:"OCOOK",label:"×˜×‘×— × ×•×¡×£",amount:c})}
    if(!isRNT&&pr.OFOOD[et]){if(!(et==="OFS"&&!food)){L.push({code:"OFOOD",label:"×¢×œ×•×ª ×¤×•×“×§×•×¡×˜",amount:totalPeople*pr.OFOOD[et],detail:`(${totalPeople} Ã— ${pr.OFOOD[et]} â‚ª)`})}}
    if(!isRNT&&protein>0&&pr.OPRO1[et]){const f15=Math.min(totalPeople,15)*30,rest=Math.max(0,totalPeople-15)*15;L.push({code:"OPRO1",label:"×¢×œ×•×ª ×—×•××¨ ×’×œ× ×—×œ×‘×•×Ÿ",amount:(f15+rest)*protein})}
    if(!isRNT&&protein>0&&pr.OPRO2[et])L.push({code:"OPRO2",label:"×¢×œ×•×ª ×—×œ×‘×•×Ÿ ×œ×©×£",amount:protein*totalPeople*pr.OPRO2[et]});
    if(!isRNT&&ceramics&&pr.OCER[et])L.push({code:"OCER",label:"×¢×œ×•×ª ×¡×“× ×ª ×§×¨××™×§×”",amount:totalPeople*pr.OCER[et]});
    if(!isRNT&&winePremium&&pr.OWINP[et])L.push({code:"OWINP",label:"×¢×œ×•×ª ×™×™×Ÿ ×¤×¨×™××™×•×",amount:adults*pr.OWINP[et]});
    if((isIncluded("FLW")||flowers)&&pr.OFLW[et])L.push({code:"OFLW",label:"×¢×œ×•×ª ×¤×¨×—×™×",amount:pr.OFLW[et]});
    if((isIncluded("WIN")||wine)&&pr.OWIN[et])L.push({code:"OWIN",label:"×¢×œ×•×ª ×™×™×Ÿ",amount:adults*pr.OWIN[et]});
    if(kosher&&pr.OKSH[et])L.push({code:"OKSH",label:"×¢×œ×•×ª ×”×›×©×¨×ª ×¨×‘",amount:pr.OKSH[et]});
    if(pr.OCLEAN[et])L.push({code:"OCLEAN",label:"× ×§×™×•×Ÿ",amount:pr.OCLEAN[et]});
    if(pr.OEVM[et])L.push({code:"OEVM",label:"×× ×”×œ ××™×¨×•×¢",amount:pr.OEVM[et]});
    if(isComputed("WTR")&&computedWaiters>0&&pr.OWTR[et])L.push({code:"OWTR",label:"××œ×¦×¨×™×",amount:computedWaiters*pr.OWTR[et],detail:`(${computedWaiters} Ã— ${pr.OWTR[et]} â‚ª)`});
    if(pr.OOVH[et])L.push({code:"OOVH",label:"×ª×§×•×¨×” ×§×‘×•×¢×”",amount:pr.OOVH[et]});
    return L},[et,adults,children,food,kosher,protein,cork,ceramics,flowers,wine,winePremium,kitchen,totalPeople,computedWaiters,csvData]);

  const allExpenseLines=useMemo(()=>{const L=[...expenseLines];const w=inp.WTR[et];if(w&&w.includes("/")&&!w.includes("ROUNDUP")&&manualWaiters>0&&pr.OWTR[et])L.push({code:"OWTR_M",label:"××œ×¦×¨×™×",amount:manualWaiters*pr.OWTR[et]});return L},[expenseLines,manualWaiters,et,csvData]);

  const subtotalIncome=incomeLines.reduce((s,l)=>s+l.amount,0);
  const childDiscount=children*100;
  const discountAmount=Math.round(subtotalIncome*discount/100);
  const REV=subtotalIncome-childDiscount-discountAmount;
  const vatAmount=Math.round(REV*VAT_RATE);
  const tipAmount=Math.round(REV*tip/100);
  const totalToPay=REV+vatAmount+tipAmount;
  const salesBonus=Math.round(REV*0.03);
  const totalExpensesBase=allExpenseLines.reduce((s,l)=>s+l.amount,0);
  const COG=totalExpensesBase+salesBonus;
  const GDP=REV-COG;

  // â•â•â• WHATSAPP MESSAGE â•â•â•
  function generateWhatsApp(){
    const eL=csvData.eventLabels[et],fmt=n=>Math.round(n).toLocaleString("he-IL");
    let m=`ğŸ›ï¸ *×—×•×‘×•×ª ×”×œ×‘×‘×•×ª - ×”×¦×¢×ª ××—×™×¨*\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\nğŸ“‹ *×¤×¨×˜×™ ×”××™×¨×•×¢:*\nâ–«ï¸ ×¡×•×’ ××™×¨×•×¢: ${eL}\nâ–«ï¸ ××¡×¤×¨ ××‘×•×’×¨×™×: ${adults}\n`;
    if(!isNotRelevant("CHD")&&children>0)m+=`â–«ï¸ ××¡×¤×¨ ×™×œ×“×™×: ${children}\n`;
    m+=`â–«ï¸ ×¡×”"×› ××•×¨×—×™×: ${totalPeople}\n\nğŸ½ï¸ *××” ×›×•×œ×œ ×”××™×¨×•×¢:*\n`;
    if(isIncluded("FOD"))m+=`âœ… ××•×›×œ - ×›×œ×•×œ ×‘×—×‘×™×œ×”\n`;else if(!isNotRelevant("FOD")&&food)m+=`âœ… ××•×›×œ\n`;
    if(isIncluded("WIN"))m+=`âœ… ×™×™×Ÿ - ×›×œ×•×œ ×‘×—×‘×™×œ×”\n`;else if(!isNotRelevant("WIN")&&wine)m+=`âœ… ×™×™×Ÿ\n`;
    if(!isNotRelevant("WINP")&&winePremium)m+=`âœ… ×ª×•×¡×¤×ª ×™×™×Ÿ ×¤×¨×™××™×•×\n`;
    if(isIncluded("FLW"))m+=`âœ… ×¡×™×“×•×¨ ×¤×¨×—×™× - ×›×œ×•×œ ×‘×—×‘×™×œ×”\n`;else if(!isNotRelevant("FLW")&&flowers)m+=`âœ… ×¡×™×“×•×¨ ×¤×¨×—×™×\n`;
    if(!isNotRelevant("PRO")&&protein>0)m+=`âœ… ×ª×•×¡×¤×ª ×× ×•×ª ×—×œ×‘×•×Ÿ: ${protein} ×œ××“×\n`;
    if(!isNotRelevant("CER")&&ceramics)m+=`âœ… ×¡×“× ×ª ×§×¨××™×§×”\n`;
    if(!isNotRelevant("KSH")&&kosher)m+=`âœ… ×”×›×©×¨×ª ×¨×‘\n`;
    if(!isNotRelevant("CRK")&&cork)m+=`âœ… ×“××™ ×—×œ×™×¦×”\n`;
    if(!isNotRelevant("WTR")){const wc=isComputed("WTR")?computedWaiters:manualWaiters;if(wc>0)m+=`âœ… ××œ×¦×¨×™×: ${wc}\n`}
    if(!isNotRelevant("KIT")&&kitchen)m+=`âœ… ×©×™××•×© ×‘××˜×‘×—\n`;
    m+=`\nğŸ’° *×¤×™×¨×•×˜ ××—×™×¨×™×:*\n`;
    incomeLines.forEach(l=>{m+=`â–«ï¸ ${l.label}: ${fmt(l.amount)} â‚ª\n`});
    m+=`\n`;
    if(childDiscount>0||discountAmount>0){m+=`ğŸ·ï¸ *×”× ×—×•×ª:*\n`;if(childDiscount>0)m+=`â–«ï¸ ×”× ×—×ª ×™×œ×“×™× (${children} ×™×œ×“×™× Ã— 100 â‚ª): -${fmt(childDiscount)} â‚ª\n`;if(discountAmount>0)m+=`â–«ï¸ ×”× ×—×” ${discount}%: -${fmt(discountAmount)} â‚ª\n`;m+=`\n`}
    m+=`â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nğŸ“Š *×¡×™×›×•× ×œ×ª×©×œ×•×:*\nâ–«ï¸ ×¡×”"×› ×œ×¤× ×™ ××¢"×: ${fmt(REV)} â‚ª\nâ–«ï¸ ××¢"× (18%): ${fmt(vatAmount)} â‚ª\n`;
    if(tipAmount>0)m+=`â–«ï¸ ×˜×™×¤ (${tip}%): ${fmt(tipAmount)} â‚ª\n`;
    m+=`\nğŸ’ *×¡×”"×› ×œ×ª×©×œ×•×: ${fmt(totalToPay)} â‚ª*\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\n_×—×•×‘×•×ª ×”×œ×‘×‘×•×ª - ×—×•×•×™×” ×§×•×œ×™× ×¨×™×ª_\n_events.hovothalevavot.com_`;
    return m}

  // â•â•â• COPY TO CLIPBOARD â•â•â•
  function handleCopyWhatsApp(){
    const msg=generateWhatsApp();
    const ta=document.createElement("textarea");ta.value=msg;ta.style.cssText="position:fixed;left:-9999px;opacity:0";document.body.appendChild(ta);ta.focus();ta.select();
    try{document.execCommand("copy");setCopyMsg("âœ“ ×”×•×¢×ª×§ ×œ×œ×•×—!")}catch(e){navigator.clipboard?.writeText(msg).then(()=>setCopyMsg("âœ“ ×”×•×¢×ª×§ ×œ×œ×•×—!")).catch(()=>setCopyMsg("×©×’×™××” ×‘×”×¢×ª×§×”"))}
    document.body.removeChild(ta);setTimeout(()=>setCopyMsg(""),3000)}

  // â•â•â• CSV UPLOAD â•â•â•
  function handleFileUpload(e){const f=e.target.files?.[0];if(!f)return;const r=new FileReader();r.onload=ev=>{try{const d=loadCSVData(ev.target.result);setCsvData(d);localStorage.setItem("hlb_csv_data",JSON.stringify(d));setEventType("PRM");setCopyMsg("âœ“ ×§×•×‘×¥ CSV × ×˜×¢×Ÿ ×•× ×©××¨!")}catch(err){setCopyMsg("×©×’×™××” ×‘×˜×¢×™× ×ª ×”×§×•×‘×¥")}setTimeout(()=>setCopyMsg(""),2500)};r.readAsText(f);e.target.value=''}

  // â•â•â• PDF TEMPLATE UPLOAD â•â•â•
  function handlePdfTemplateUpload(e){const f=e.target.files?.[0];if(!f)return;const r=new FileReader();r.onload=ev=>{const ab=ev.target.result;setPdfTemplate(ab);try{const bytes=new Uint8Array(ab);let bin='';for(let i=0;i<bytes.length;i++)bin+=String.fromCharCode(bytes[i]);localStorage.setItem("hlb_pdf_template",btoa(bin));setCopyMsg("âœ“ ×ª×‘× ×™×ª PDF × ×©××¨×”!")}catch(err){setCopyMsg("âœ“ ×ª×‘× ×™×ª PDF × ×˜×¢× ×”")}setTimeout(()=>setCopyMsg(""),2500)};r.readAsArrayBuffer(f);e.target.value=''}

  // â•â•â• PDF GENERATION â•â•â•
  async function handleGeneratePdf(){
    if(!pdfTemplate){setCopyMsg("âš ï¸ ×™×© ×œ×”×¢×œ×•×ª ×ª×‘× ×™×ª PDF (×¤×¢× ×¨××©×•× ×” ×‘×œ×‘×“)");setTimeout(()=>setCopyMsg(""),3000);return}
    if(!window.PDFLib){setCopyMsg("âš ï¸ ×¡×¤×¨×™×™×ª PDF ×¢×“×™×™×Ÿ × ×˜×¢× ×ª, × ×¡×” ×©×•×‘");setTimeout(()=>setCopyMsg(""),3000);return}
    setPdfGenerating(true);setCopyMsg("××™×™×¦×¨ PDF...");
    try{
      const{PDFDocument,rgb}=window.PDFLib;
      const templateDoc=await PDFDocument.load(pdfTemplate);
      const newDoc=await PDFDocument.create();
      const[p1,p2]=await newDoc.copyPages(templateDoc,[0,1]);newDoc.addPage(p1);newDoc.addPage(p2);

      // Page 3: render WhatsApp text as image via canvas
      const tp3=templateDoc.getPage(2);const{width:pw,height:ph}=tp3.getSize();
      const[p3c]=await newDoc.copyPages(templateDoc,[2]);newDoc.addPage(p3c);
      const page3=newDoc.getPage(2);
      page3.drawRectangle({x:0,y:0,width:pw,height:ph-90,color:rgb(251/255,237/255,223/255)});

      const wt=generateWhatsApp();
      const sc=2,cW=Math.round(pw*sc),cH=Math.round((ph-100)*sc);
      const cvs=document.createElement("canvas");cvs.width=cW;cvs.height=cH;
      const ctx=cvs.getContext("2d");
      ctx.fillStyle="#FBEDDF";ctx.fillRect(0,0,cW,cH);
      const rawLines=wt.split('\n');let y=40*sc;const nS=11*sc,hS=13*sc,tS=15*sc,mg=50*sc;
      ctx.textAlign="right";ctx.direction="rtl";const rX=cW-mg;
      for(const rl of rawLines){
        if(y>cH-20)break;const ln=rl.trim();if(!ln){y+=nS*0.6;continue}
        const isSep=ln.includes('â”â”â”');const isB=ln.startsWith('*')||(ln.includes('*')&&ln.lastIndexOf('*')>ln.indexOf('*'));
        const dt=ln.replace(/\*/g,'').replace(/â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”/g,'');
        const isTot=dt.includes('×¡×”"×› ×œ×ª×©×œ×•×');const isMH=dt.includes('×—×•×‘×•×ª ×”×œ×‘×‘×•×ª - ×”×¦×¢×ª ××—×™×¨');
        const isSH=dt.includes('×¤×¨×˜×™ ×”××™×¨×•×¢:')||dt.includes('××” ×›×•×œ×œ ×”××™×¨×•×¢:')||dt.includes('×¤×™×¨×•×˜ ××—×™×¨×™×:')||dt.includes('×¡×™×›×•× ×œ×ª×©×œ×•×:')||dt.includes('×”× ×—×•×ª:');
        if(isSep){ctx.strokeStyle="#C8B4AA";ctx.lineWidth=1*sc;ctx.beginPath();ctx.moveTo(mg,y);ctx.lineTo(cW-mg,y);ctx.stroke();y+=nS*0.6;continue}
        let fs=nS,fw="400",cl="#503228";
        if(isTot){fs=tS;fw="800";cl="#1043BF"}else if(isMH){fs=hS;fw="700";cl="#1043BF"}else if(isSH||isB){fs=nS*1.05;fw="700";cl="#1043BF"}
        ctx.font=`${fw} ${fs}px "Assistant","Heebo","Arial Hebrew","Segoe UI",Arial,sans-serif`;ctx.fillStyle=cl;ctx.fillText(dt,rX,y);y+=fs*1.5}
      const pngB64=cvs.toDataURL("image/png").split(",")[1];
      const pngBytes=Uint8Array.from(atob(pngB64),c=>c.charCodeAt(0));
      const pngImg=await newDoc.embedPng(pngBytes);
      page3.drawImage(pngImg,{x:5,y:5,width:pw-10,height:ph-100});

      if(templateDoc.getPageCount()>=4){const[p4]=await newDoc.copyPages(templateDoc,[3]);newDoc.addPage(p4)}
      const pdfBytes=await newDoc.save();const blob=new Blob([pdfBytes],{type:"application/pdf"});
      const url=URL.createObjectURL(blob);const a=document.createElement("a");a.href=url;a.download="×”×¦×¢×ª_××—×™×¨_×—×•×‘×•×ª_×”×œ×‘×‘×•×ª.pdf";document.body.appendChild(a);a.click();document.body.removeChild(a);URL.revokeObjectURL(url);
      setCopyMsg("âœ“ PDF ×”×•×¨×“ ×‘×”×¦×œ×—×”!");setTimeout(()=>setCopyMsg(""),3000);
    }catch(err){console.error(err);setCopyMsg("×©×’×™××” ×‘×™×¦×™×¨×ª PDF: "+err.message);setTimeout(()=>setCopyMsg(""),4000)}
    finally{setPdfGenerating(false)}}

  // â•â•â• RENDER â•â•â•
  const e=React.createElement;
  return e('div',{style:{minHeight:"100vh",background:`linear-gradient(170deg,${C.lightCream} 0%,${C.cream} 40%,${C.sand} 100%)`,fontFamily:"'Assistant','Heebo',sans-serif",direction:"rtl"}},

    // Header
    e('div',{style:{background:`linear-gradient(135deg,${C.brick} 0%,${C.rust} 50%,${C.darkBrick} 100%)`,padding:"24px 20px 20px",textAlign:"center",boxShadow:"0 4px 20px rgba(139,48,32,0.3)"}},
      e('h1',{style:{margin:0,fontSize:28,fontWeight:800,color:C.cream,fontFamily:"'Playfair Display',serif",letterSpacing:1}},"×—×•×‘×•×ª ×”×œ×‘×‘×•×ª"),
      e('p',{style:{margin:"4px 0 0",fontSize:14,color:C.tan,fontWeight:300,letterSpacing:2}},"××—×©×‘×•×Ÿ ×ª××—×•×¨ ××™×¨×•×¢×™×")),

    e('div',{style:{maxWidth:900,margin:"0 auto",padding:"16px 12px 40px"}},

      // Upload Buttons
      e('div',{style:{display:"flex",justifyContent:"flex-start",marginBottom:12,gap:10,alignItems:"center",flexWrap:"wrap"}},
        e('button',{onClick:()=>fileInputRef.current?.click(),style:{padding:"8px 18px",borderRadius:8,backgroundColor:C.terracotta,color:C.white,border:"none",cursor:"pointer",fontFamily:"'Assistant',sans-serif",fontSize:13,fontWeight:600,boxShadow:"0 2px 8px rgba(0,0,0,0.15)"}},"ğŸ“ ×”×¢×œ××ª CSV"),
        e('input',{ref:fileInputRef,type:"file",accept:".csv",onChange:handleFileUpload,style:{display:"none"}}),
        e('button',{onClick:()=>pdfInputRef.current?.click(),style:{padding:"8px 18px",borderRadius:8,backgroundColor:pdfTemplate?C.sage:C.brick,color:C.white,border:"none",cursor:"pointer",fontFamily:"'Assistant',sans-serif",fontSize:13,fontWeight:600,boxShadow:"0 2px 8px rgba(0,0,0,0.15)"}},pdfTemplate?"âœ“ ×ª×‘× ×™×ª PDF ××•×›× ×”":"ğŸ“„ ×”×¢×œ××ª ×ª×‘× ×™×ª PDF"),
        e('input',{ref:pdfInputRef,type:"file",accept:".pdf",onChange:handlePdfTemplateUpload,style:{display:"none"}})),

      // Event Type
      e('div',{style:{backgroundColor:C.white,borderRadius:12,padding:16,marginBottom:12,boxShadow:"0 2px 12px rgba(139,48,32,0.08)",border:`1px solid ${C.tan}`}},
        e('label',{style:{fontSize:16,fontWeight:700,color:C.brick,display:"block",marginBottom:8}},"×¡×•×’ ××™×¨×•×¢"),
        e('select',{value:eventType,onChange:ev=>setEventType(ev.target.value),style:{width:"100%",padding:"10px 14px",borderRadius:8,border:`2px solid ${C.brick}`,backgroundColor:C.lightCream,fontSize:16,fontWeight:600,color:C.darkBrick,fontFamily:"'Assistant',sans-serif",cursor:"pointer"}},csvData.eventTypes.map(t=>e('option',{key:t,value:t},csvData.eventLabels[t])))),

      // Parameters
      e('div',{style:{backgroundColor:C.white,borderRadius:12,padding:16,marginBottom:12,boxShadow:"0 2px 12px rgba(139,48,32,0.08)",border:`1px solid ${C.tan}`}},
        e('h2',{style:{fontSize:16,fontWeight:700,color:C.brick,margin:"0 0 12px",borderBottom:`2px solid ${C.cream}`,paddingBottom:8}},"×¤×¨××˜×¨×™ ×”××™×¨×•×¢"),
        e('div',{style:{display:"flex",flexDirection:"column",gap:12}},
          adultRange&&e(NumberSlider,{label:"×›××•×ª ××‘×•×’×¨×™×",min:adultRange[0],max:adultRange[1],value:adults,onChange:setAdults}),
          childRange&&e(NumberSlider,{label:"×›××•×ª ×™×œ×“×™×",min:childRange[0],max:childRange[1],value:children,onChange:setChildren,note:children>0?`×”× ×—×” ×©×œ 100 â‚ª ×œ×™×œ×“`:null}),
          e(ComputedField,{label:"×¡×”×´×› ×× ×©×™×",value:totalPeople}),
          !isNotRelevant("FOD")&&!isIncluded("FOD")&&e(CheckboxField,{label:"×”×× × ×“×¨×© ××•×›×œ?",checked:food,onChange:ev=>setFood(ev.target.checked)}),
          isIncluded("FOD")&&e(IncludedField,{label:"××•×›×œ"}),
          !isNotRelevant("KSH")&&e(CheckboxField,{label:"×”×›×©×¨×ª ×¨×‘",checked:kosher,onChange:ev=>setKosher(ev.target.checked)}),
          !isNotRelevant("WTR")&&isComputed("WTR")&&e(ComputedField,{label:"××œ×¦×¨×™×",value:computedWaiters}),
          !isNotRelevant("WTR")&&!isComputed("WTR")&&e(SelectField,{label:"××œ×¦×¨×™×",options:[{value:"0",label:"0"},{value:"1",label:"1"},{value:"2",label:"2"}],value:String(manualWaiters),onChange:v=>setManualWaiters(Number(v))}),
          !isNotRelevant("PRO")&&e(SelectField,{label:"×ª×•×¡×¤×ª ×× ×•×ª ×—×œ×‘×•×Ÿ (×œ××“×)",options:[{value:"0",label:"0"},{value:"1",label:"1"},{value:"2",label:"2"}],value:String(protein),onChange:v=>setProtein(Number(v))}),
          !isNotRelevant("CRK")&&e(CheckboxField,{label:"×“××™ ×—×œ×™×¦×”",checked:cork,onChange:ev=>setCork(ev.target.checked)}),
          !isNotRelevant("CER")&&e(CheckboxField,{label:"×¡×“× ×ª ×§×¨××™×§×”",checked:ceramics,onChange:ev=>setCeramics(ev.target.checked)}),
          !isNotRelevant("FLW")&&!isIncluded("FLW")&&e(CheckboxField,{label:"×¡×™×“×•×¨ ×¤×¨×—×™×",checked:flowers,onChange:ev=>setFlowers(ev.target.checked)}),
          isIncluded("FLW")&&e(IncludedField,{label:"×¡×™×“×•×¨ ×¤×¨×—×™×"}),
          !isNotRelevant("WIN")&&!isIncluded("WIN")&&e(CheckboxField,{label:"×™×™×Ÿ",checked:wine,onChange:ev=>setWine(ev.target.checked)}),
          isIncluded("WIN")&&e(IncludedField,{label:"×™×™×Ÿ"}),
          !isNotRelevant("WINP")&&e(CheckboxField,{label:"×ª×•×¡×¤×ª ×™×™×Ÿ ×¤×¨×™××™×•×",checked:winePremium,onChange:ev=>setWinePremium(ev.target.checked)}),
          !isNotRelevant("KIT")&&e(CheckboxField,{label:"×©×™××•×© ×‘××˜×‘×—",checked:kitchen,onChange:ev=>setKitchen(ev.target.checked)}),
          e(SliderField,{label:"××—×•×–×™ ×”× ×—×”",min:0,max:15,value:discount,onChange:setDiscount}),
          e(SliderField,{label:"××—×•×–×™ ×˜×™×¤",min:0,max:15,value:tip,onChange:setTip}))),

      // Pricing - Two Columns
      e('div',{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12,marginBottom:12}},
        // Income
        e('div',{style:{backgroundColor:C.white,borderRadius:12,padding:16,boxShadow:"0 2px 12px rgba(139,48,32,0.08)",border:`1px solid ${C.tan}`}},
          e('h2',{style:{fontSize:16,fontWeight:700,color:"#2E7D32",margin:"0 0 12px",borderBottom:"2px solid #C8E6C9",paddingBottom:8,display:"flex",alignItems:"center",gap:6}},"ğŸ’° ×”×›× ×¡×•×ª"),
          incomeLines.map((l,i)=>e(PricingLine,{key:i,label:l.label,amount:l.amount,detail:l.detail})),
          e('div',{style:{height:1,backgroundColor:C.tan,margin:"8px 0"}}),
          e(SummaryLine,{label:"×¡×”×´×› ×”×›× ×¡×•×ª (×‘×¨×•×˜×•)",amount:subtotalIncome}),
          childDiscount>0&&e(PricingLine,{label:`×”× ×—×ª ×™×œ×“×™× (${children} Ã— 100 â‚ª)`,amount:-childDiscount}),
          discountAmount>0&&e(PricingLine,{label:`×”× ×—×” (${discount}%)`,amount:-discountAmount}),
          e(SummaryLine,{label:"×¡×”×´×› ×œ×¤× ×™ ××¢×´× (REV)",amount:REV}),
          e(PricingLine,{label:'××¢"× (18%)',amount:vatAmount}),
          tipAmount>0&&e(PricingLine,{label:`×˜×™×¤ (${tip}%)`,amount:tipAmount}),
          e(SummaryLine,{label:"×¡×”×´×› ×œ×ª×©×œ×•×",amount:totalToPay,isTotal:true})),
        // Expenses
        e('div',{style:{backgroundColor:C.white,borderRadius:12,padding:16,boxShadow:"0 2px 12px rgba(139,48,32,0.08)",border:`1px solid ${C.tan}`}},
          e('h2',{style:{fontSize:16,fontWeight:700,color:"#D32F2F",margin:"0 0 12px",borderBottom:"2px solid #FFCDD2",paddingBottom:8,display:"flex",alignItems:"center",gap:6}},"ğŸ“Š ×”×•×¦××•×ª"),
          allExpenseLines.map((l,i)=>e(PricingLine,{key:i,label:l.label,amount:l.amount,detail:l.detail,isExpense:true})),
          e('div',{style:{height:1,backgroundColor:C.tan,margin:"8px 0"}}),
          e(PricingLine,{label:"×‘×•× ×•×¡ ×× ×”×œ ××›×™×¨×•×ª (3%)",amount:salesBonus,isExpense:true,detail:`(3% Ã— ${Math.round(REV).toLocaleString("he-IL")} â‚ª)`}),
          e(SummaryLine,{label:"×¡×”×´×› ×”×•×¦××•×ª (COG)",amount:COG,isExpense:true}))),

      // Gross Profit
      e('div',{style:{backgroundColor:C.white,borderRadius:12,padding:16,marginBottom:12,boxShadow:"0 2px 12px rgba(139,48,32,0.08)",border:`2px solid ${GDP>=0?'#2E7D32':'#D32F2F'}`}},
        e('div',{style:{display:"flex",justifyContent:"space-between",alignItems:"center",direction:"rtl"}},
          e('span',{style:{fontSize:18,fontWeight:800,color:C.darkBrick}},"×¨×•×•×— ×’×•×œ××™ (GDP)"),
          e('span',{style:{fontSize:22,fontWeight:800,color:GDP>=0?"#2E7D32":"#D32F2F",direction:"ltr"}},formatNIS(GDP))),
        e('div',{style:{display:"flex",justifyContent:"space-between",marginTop:6,fontSize:13,color:C.sage,direction:"rtl"}},
          e('span',null,`××—×•×– ×¨×•×•×—: ${REV>0?Math.round(GDP/REV*100):0}%`),
          e('span',null,`REV: ${formatNIS(REV)} | COG: ${formatNIS(COG)}`))),

      // WhatsApp Button
      e('button',{onClick:handleCopyWhatsApp,style:{width:"100%",padding:"14px 20px",borderRadius:12,backgroundColor:"#25D366",color:C.white,border:"none",cursor:"pointer",fontFamily:"'Assistant',sans-serif",fontSize:17,fontWeight:700,boxShadow:"0 4px 15px rgba(37,211,102,0.3)",display:"flex",alignItems:"center",justifyContent:"center",gap:8}},e('span',null,"ğŸ“‹"),e('span',null,"×”×¢×ª×§ ×”×¦×¢×ª ××—×™×¨ ×œ×•×•×˜×¡××¤")),

      // PDF Button
      e('button',{onClick:handleGeneratePdf,disabled:pdfGenerating,style:{width:"100%",padding:"14px 20px",borderRadius:12,marginTop:10,backgroundColor:pdfTemplate?C.brick:C.sand,color:C.white,border:"none",cursor:pdfTemplate?"pointer":"default",fontFamily:"'Assistant',sans-serif",fontSize:17,fontWeight:700,boxShadow:pdfTemplate?"0 4px 15px rgba(183,79,62,0.3)":"none",display:"flex",alignItems:"center",justifyContent:"center",gap:8,opacity:pdfGenerating?.7:1}},e('span',null,"ğŸ“„"),e('span',null,pdfGenerating?"××™×™×¦×¨ PDF...":pdfTemplate?"×”×•×¨×“ ×”×¦×¢×ª ××—×™×¨ PDF":"×”×¢×œ×” ×ª×‘× ×™×ª PDF ×§×•×“×")),

      // Status Message
      copyMsg&&e('div',{style:{textAlign:"center",marginTop:10,padding:"8px 16px",borderRadius:8,backgroundColor:copyMsg.includes("×©×’×™××”")||copyMsg.includes("âš ï¸")?"#FFEBEE":"#E8F5E9",color:copyMsg.includes("×©×’×™××”")||copyMsg.includes("âš ï¸")?"#D32F2F":"#2E7D32",fontWeight:700,fontSize:15,fontFamily:"'Assistant',sans-serif"}},copyMsg)))
}

ReactDOM.render(React.createElement(App),document.getElementById("root"));
</script>
</body>
</html>
